# [dynamic array default - tramway lines scenario](../../route_document_url_sync.test.js)

```js
const navToCalls = [];

setRouteIntegration({
  navTo: (url) => {
    navToCalls.push(url);
    updateRoutes(url);
    return Promise.resolve();
  },
});

try {
  // Simulate available tramway lines from backend (dynamic)
  const tramAvailableLines = stateSignal([], {
    type: "array",
  });
  // User-enabled tramway lines - defaults to all available lines
  const tramEnabledLines = stateSignal(tramAvailableLines, {
    type: "array",
  });
  // Master tramway visibility toggle
  const tramVisible = stateSignal(false, {
    type: "boolean",
  });
  setupRoutes({
    TRAM_ROUTE: `/map?tram=${tramVisible}&trams=${tramEnabledLines}`,
  });

  const captureState = () => {
    const navCalls = [...navToCalls];
    navToCalls.length = 0;
    return {
      available_lines: JSON.parse(JSON.stringify(tramAvailableLines.value)),
      enabled_lines: JSON.parse(JSON.stringify(tramEnabledLines.value)),
      tram_signal_visible: tramVisible.value,
      nav_calls: navCalls,
    };
  };

  const results = {};

  // Step 1: Initial state before backend loads data - no available lines
  updateRoutes(`${baseUrl}/map`);
  results["1_initial_state_no_backend_data"] = captureState();

  // Step 2: User enables tramways for first time but no backend data yet
  tramVisible.value = true;
  results["2_user_enables_tramways_no_backend_data"] = captureState();

  // Step 3: Backend loads available tramway lines - signals should update
  tramAvailableLines.value = ["a", "b", "c"];
  results["3_backend_loads_available_lines"] = captureState();

  // Step 4: User disables one specific line (line "b") - now becomes custom selection
  tramEnabledLines.value = ["a", "c"];
  results["4_user_disables_line_b"] = captureState();

  // Step 5: User toggles tramway visibility off and back on - should preserve selection
  tramVisible.value = false;
  results["5_user_hides_tramways"] = captureState();

  tramVisible.value = true;
  results["6_user_shows_tramways_again"] = captureState();

  // Step 6: User re-enables line "b" - should match available lines again (not custom)
  tramEnabledLines.value = ["a", "b", "c"];
  results["7_user_re_enables_line_b"] = captureState();

  // Step 7: Backend adds new line - user's selection should now be default again
  tramAvailableLines.value = ["a", "b", "c", "d"];
  results["8_backend_adds_line_d"] = captureState();

  return results;
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
  setRouteIntegration(null);
}
```

```js
{
  "1_initial_state_no_backend_data": {
    "available_lines": [],
    "enabled_lines": [],
    "tram_signal_visible": false,
    "nav_calls": []
  },
  "2_user_enables_tramways_no_backend_data": {
    "available_lines": [],
    "enabled_lines": [],
    "tram_signal_visible": true,
    "nav_calls": [
      "http://127.0.0.1/map?tram"
    ]
  },
  "3_backend_loads_available_lines": {
    "available_lines": [
      "a",
      "b",
      "c"
    ],
    "enabled_lines": [
      "a",
      "b",
      "c"
    ],
    "tram_signal_visible": true,
    "nav_calls": []
  },
  "4_user_disables_line_b": {
    "available_lines": [
      "a",
      "b",
      "c"
    ],
    "enabled_lines": [
      "a",
      "c"
    ],
    "tram_signal_visible": true,
    "nav_calls": [
      "http://127.0.0.1/map?tram&trams=a,c"
    ]
  },
  "5_user_hides_tramways": {
    "available_lines": [
      "a",
      "b",
      "c"
    ],
    "enabled_lines": [
      "a",
      "c"
    ],
    "tram_signal_visible": false,
    "nav_calls": [
      "http://127.0.0.1/map?trams=a,c"
    ]
  },
  "6_user_shows_tramways_again": {
    "available_lines": [
      "a",
      "b",
      "c"
    ],
    "enabled_lines": [
      "a",
      "c"
    ],
    "tram_signal_visible": true,
    "nav_calls": [
      "http://127.0.0.1/map?tram&trams=a,c"
    ]
  },
  "7_user_re_enables_line_b": {
    "available_lines": [
      "a",
      "b",
      "c"
    ],
    "enabled_lines": [
      "a",
      "b",
      "c"
    ],
    "tram_signal_visible": true,
    "nav_calls": [
      "http://127.0.0.1/map?tram"
    ]
  },
  "8_backend_adds_line_d": {
    "available_lines": [
      "a",
      "b",
      "c",
      "d"
    ],
    "enabled_lines": [
      "a",
      "b",
      "c",
      "d"
    ],
    "tram_signal_visible": true,
    "nav_calls": []
  }
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
