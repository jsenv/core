# [signal updates should trigger redirect on most specific matching route](../../route_document_url_sync.test.js)

```js
try {
  const zoomSignal = stateSignal(12, {
    id: "hierarchyZoom",
    type: "number",
  });

  const { MAP_ROUTE, MAP_ISOCHRONE_ROUTE, MAP_COMPARE_ROUTE } = setupRoutes(
    {
      MAP_ROUTE: `/map?zoom=${zoomSignal}`,
      MAP_ISOCHRONE_ROUTE: `/map/isochrone?zoom=${zoomSignal}`,
      MAP_COMPARE_ROUTE: `/map/isochrone/compare?zoom=${zoomSignal}`,
    },
  );

  // Start on deeply nested route
  updateRoutes(`${baseUrl}/map/isochrone/compare?zoom=15`);

  const navToCalls = [];

  // Mock browser integration to track navigation calls
  const mockBrowserIntegration = {
    navTo: (url) => {
      navToCalls.push(url);
      updateRoutes(url);
      return Promise.resolve();
    },
  };
  setBrowserIntegration(mockBrowserIntegration);

  // When signal changes, this should trigger replaceParams on all matching routes
  // but the actual redirect should happen on the most specific one
  zoomSignal.value = 20;

  return {
    // Route matching states
    routes_matching: {
      map: MAP_ROUTE.matching,
      isochrone: MAP_ISOCHRONE_ROUTE.matching,
      compare: MAP_COMPARE_ROUTE.matching,
    },

    // Track navigation calls
    nav_to_calls: navToCalls,

    // Verify navigation happened to correct URL
    most_specific_url_used:
      navToCalls.length > 0
        ? navToCalls[navToCalls.length - 1].url
        : "none",

    // The URL that should be generated
    expected_url_pattern: "/map/isochrone/compare?zoom=20",
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```js
{
  "routes_matching": {
    "map": true,
    "isochrone": true,
    "compare": true
  },
  "nav_to_calls": [
    "http://127.0.0.1/map/isochrone/compare?zoom=20"
  ],
  "most_specific_url_used": undefined,
  "expected_url_pattern": "/map/isochrone/compare?zoom=20"
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
