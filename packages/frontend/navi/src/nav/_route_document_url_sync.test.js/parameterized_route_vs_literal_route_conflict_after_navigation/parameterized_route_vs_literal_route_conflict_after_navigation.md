# [parameterized route vs literal route conflict after navigation](../../route_document_url_sync.test.js)

```js
try {
  const zoomSignal = stateSignal(10, {
    id: "conflictZoom",
    type: "number",
  });

  // Routes that create the conflict:
  // /map/ - base route with signal
  // /map/:panel/ - parameterized route
  // /map/isochrone/ - literal route that conflicts with :panel
  const { MAP_ROUTE, MAP_PANEL_ROUTE, MAP_ISOCHRONE_ROUTE } = setupRoutes({
    MAP_ROUTE: `/map?zoom=${zoomSignal}`,
    MAP_PANEL_ROUTE: `/map/:panel`,
    MAP_ISOCHRONE_ROUTE: `/map/isochrone`,
  });

  const navToCalls = [];

  // Mock browser integration to track navigation calls
  const routeIntegrationMock = {
    navTo: (url) => {
      navToCalls.push(url);
      updateRoutes(url);
      return Promise.resolve();
    },
  };
  setRouteIntegration(routeIntegrationMock);

  // STEP 1: Navigate to /map/isochrone/
  // This should match both MAP_PANEL_ROUTE (:panel = "isochrone") AND MAP_ISOCHRONE_ROUTE
  updateRoutes(`${baseUrl}/map/isochrone`);

  const step1State = {
    map_matching: MAP_ROUTE.matching,
    panel_matching: MAP_PANEL_ROUTE.matching,
    isochrone_matching: MAP_ISOCHRONE_ROUTE.matching,
  };

  // STEP 2: Navigate to /map/
  // Now we should be on the base route only
  updateRoutes(`${baseUrl}/map`);

  const step2State = {
    map_matching: MAP_ROUTE.matching,
    panel_matching: MAP_PANEL_ROUTE.matching,
    isochrone_matching: MAP_ISOCHRONE_ROUTE.matching,
  };

  // Clear navigation calls from initial setup
  navToCalls.length = 0;

  // STEP 3: Update the zoom signal
  // This should stay on /map/, not redirect to /map/isochrone/
  zoomSignal.value = 15;

  return {
    step1_route_matching: step1State,
    step2_route_matching: step2State,

    // After signal update - should navigate to stay on /map
    final_nav_to_calls: navToCalls,

    // Expected behavior: Should stay on /map?zoom=15
    expected_url: "/map?zoom=15",

    // Actual behavior
    actual_url:
      navToCalls.length > 0 ? navToCalls[navToCalls.length - 1] : "none",

    // Problem indicator: Should navigate to correct URL
    test_passes:
      navToCalls.length > 0 &&
      navToCalls[navToCalls.length - 1].includes("zoom=15"),
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```js
{
  "step1_route_matching": {
    "map_matching": true,
    "panel_matching": true,
    "isochrone_matching": true
  },
  "step2_route_matching": {
    "map_matching": true,
    "panel_matching": false,
    "isochrone_matching": false
  },
  "final_nav_to_calls": [
    "http://127.0.0.1/map?zoom=15"
  ],
  "expected_url": "/map?zoom=15",
  "actual_url": "http://127.0.0.1/map?zoom=15",
  "test_passes": true
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
