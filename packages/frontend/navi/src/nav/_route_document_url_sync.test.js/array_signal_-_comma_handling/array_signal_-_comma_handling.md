# [array signal - comma handling](../../route_document_url_sync.test.js)

```js
const navToCalls = [];

setRouteIntegration({
  navTo: (url) => {
    navToCalls.push(url);
    updateRoutes(url);
    return Promise.resolve();
  },
});

try {
  const itemsSignal = stateSignal([], {
    id: "itemsWithCommas",
    type: "array",
  });
  const { ITEMS_ROUTE } = setupRoutes({
    ITEMS_ROUTE: `/items?items=${itemsSignal}`,
  });

  const captureState = () => {
    const navCalls = [...navToCalls];
    navToCalls.length = 0;
    return {
      signal_value: JSON.parse(JSON.stringify(ITEMS_ROUTE.value)),
      route_matching: ITEMS_ROUTE.matching,
      nav_calls: navCalls,
    };
  };

  const results = {};

  // Test signal with comma value → URL
  itemsSignal.value = ["item1", "item,with,commas", "item3"];
  results["signal_to_url_with_commas"] = captureState();

  // Test URL with comma → signal (the reverse direction)
  updateRoutes(
    `${baseUrl}/items?items=simple,item%2Cwith%2Ccommas,another`,
  );
  results["url_to_signal_with_commas"] = captureState();

  // Test edge case: value that is just a comma
  itemsSignal.value = ["before", ",", "after"];
  results["signal_pure_comma"] = captureState();

  // Test edge case: value with multiple commas
  itemsSignal.value = ["alpha", "beta,gamma,delta", "omega"];
  results["signal_multiple_commas"] = captureState();

  return results;
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
  setRouteIntegration(null);
}
```

```console
SyntaxError: "undefined" is not valid JSON
  at JSON.parse (<anonymous>)
  at captureState (base/route_document_url_sync.test.js:1794:30)
  at base/route_document_url_sync.test.js:1804:46
  at capture (@jsenv/core/packages/tooling/snapshot/src/side_effects/create_capture_side_effects.js:342:29)
  at snapshotTests (@jsenv/core/packages/tooling/snapshot/src/side_effects/snapshot_tests.js:185:33)
  at async base/route_document_url_sync.test.js:15:1
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
