# [array signal - comma handling](../../route_document_url_sync.test.js)

```js
const navToCalls = [];

setRouteIntegration({
  navTo: (url) => {
    navToCalls.push(url);
    updateRoutes(url);
    return Promise.resolve();
  },
});

try {
  const itemsSignal = stateSignal([], {
    id: "itemsWithCommas",
    type: "array",
  });
  const { ITEMS_ROUTE } = setupRoutes({
    ITEMS_ROUTE: `/items?items=${itemsSignal}`,
  });

  const captureState = () => {
    const navCalls = [...navToCalls];
    navToCalls.length = 0;
    return {
      signal_value: JSON.parse(JSON.stringify(itemsSignal.value)),
      route_matching: ITEMS_ROUTE.matching,
      nav_calls: navCalls,
    };
  };

  updateRoutes(`${baseUrl}/items`);

  const results = {};

  // Test signal with comma value → URL
  itemsSignal.value = ["item1", "item,with,commas", "item3"];
  results["signal_to_url_with_commas"] = captureState();

  // Test URL with comma → signal (the reverse direction)
  updateRoutes(
    `${baseUrl}/items?items=simple,item%2Cwith%2Ccommas,another`,
  );
  results["url_to_signal_with_commas"] = captureState();

  // Test edge case: value that is just a comma
  itemsSignal.value = ["before", ",", "after"];
  results["signal_pure_comma"] = captureState();

  // Test edge case: value with multiple commas
  itemsSignal.value = ["alpha", "beta,gamma,delta", "omega"];
  results["signal_multiple_commas"] = captureState();

  return results;
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
  setRouteIntegration(null);
}
```

```js
{
  "signal_to_url_with_commas": {
    "signal_value": [
      "item1",
      "item,with,commas",
      "item3"
    ],
    "route_matching": true,
    "nav_calls": [
      "http://127.0.0.1/items?items=item1,item%2Cwith%2Ccommas,item3"
    ]
  },
  "url_to_signal_with_commas": {
    "signal_value": [
      "simple",
      "item,with,commas",
      "another"
    ],
    "route_matching": true,
    "nav_calls": []
  },
  "signal_pure_comma": {
    "signal_value": [
      "before",
      ",",
      "after"
    ],
    "route_matching": true,
    "nav_calls": [
      "http://127.0.0.1/items?items=before,%2C,after"
    ]
  },
  "signal_multiple_commas": {
    "signal_value": [
      "alpha",
      "beta,gamma,delta",
      "omega"
    ],
    "route_matching": true,
    "nav_calls": [
      "http://127.0.0.1/items?items=alpha,beta%2Cgamma%2Cdelta,omega"
    ]
  }
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
