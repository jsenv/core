# [signal should be cleared when route stops matching](../../route_document_url_sync.test.js)

```js
try {
  const zoomSignal = stateSignal(10, {
    id: "clearingTestZoom",
    type: "number",
  });

  const panelSignal = stateSignal(undefined, {
    id: "clearingTestPanel",
    type: "string",
  });

  // Set the panel signal to "isochrone" initially
  panelSignal.value = "isochrone";

  // Use two routes: one for base map, one for panel
  // The key is that when navigating from panel route to base route,
  // the panel signal should be cleared because the new URL doesn't include it
  const { MAP_ROUTE, MAP_PANEL_ROUTE } = setupRoutes({
    MAP_ROUTE: `/map?zoom=${zoomSignal}`,
    MAP_PANEL_ROUTE: `/map/:panel={navi_state_signal:clearingTestPanel}?zoom=${zoomSignal}`,
  });

  // Start with panel signal set to "isochrone"
  panelSignal.value = "isochrone";

  // Navigate to /map/isochrone - panel route should match
  updateRoutes(`${baseUrl}/map/isochrone?zoom=10`);

  const afterPanelNav = {
    url: `/map/isochrone?zoom=10`,
    panel_signal: panelSignal.value,
    routes: {
      map: MAP_ROUTE.matching,
      panel: MAP_PANEL_ROUTE.matching,
    },
  };

  // Navigate to /map - base route should match, panel route should not
  // The panel signal should remain as is (preserving user preference)
  updateRoutes(`${baseUrl}/map?zoom=10`);

  const afterMapNav = {
    url: `/map?zoom=10`,
    panel_signal: panelSignal.value,
    routes: {
      map: MAP_ROUTE.matching,
      panel: MAP_PANEL_ROUTE.matching,
    },
  };

  return {
    after_panel_nav: afterPanelNav,
    after_map_nav: afterMapNav,

    // Verify that routes match correctly
    panel_route_stops_matching:
      !afterMapNav.routes.panel && afterPanelNav.routes.panel,
    base_route_starts_matching:
      afterMapNav.routes.map && !afterPanelNav.routes.map,

    // Test pattern family behavior - signal should be cleared when navigating within same family
    signal_cleared_within_same_family: panelSignal.value === undefined,
    // Current signal value for debugging
    current_panel_signal: panelSignal.value,
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```js
{
  "after_panel_nav": {
    "url": "/map/isochrone?zoom=10",
    "panel_signal": "isochrone",
    "routes": {
      "map": true,
      "panel": true
    }
  },
  "after_map_nav": {
    "url": "/map?zoom=10",
    "panel_signal": undefined,
    "routes": {
      "map": true,
      "panel": false
    }
  },
  "panel_route_stops_matching": true,
  "base_route_starts_matching": false,
  "signal_cleared_within_same_family": true,
  "current_panel_signal": undefined
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
