# [replaceParams should use most specific route for redirect](../../route_document_url_sync.test.js)

```js
try {
  const zoomSignal = stateSignal(12, {
    id: "mapZoom",
    type: "number",
  });

  // Create routes with proper parent-child relationship
  const { MAP_ROUTE, MAP_ISOCHRONE_ROUTE, MAP_ISOCHRONE_COMPARE_ROUTE } =
    setupRoutes({
      MAP_ROUTE: `/map/?zoom=${zoomSignal}`, // Parent route with trailing slash
      MAP_ISOCHRONE_ROUTE: `/map/isochrone`, // Intermediate child
      MAP_ISOCHRONE_COMPARE_ROUTE: `/map/isochrone/compare`, // Deepest child
    });

  // Simulate being on the child route: /map/isochrone/compare?zoom=10
  updateRoutes(`${baseUrl}/map/isochrone/compare?zoom=10`);

  // Mock browser integration to track navigation calls
  const navToCalls = [];
  const routeIntegrationMock = {
    navTo: (url) => {
      navToCalls.push(url);
      updateRoutes(url);
      return Promise.resolve();
    },
  };
  setRouteIntegration(routeIntegrationMock);

  // This should trigger replaceParams on the parent route (which now matches due to trailing slash)
  // But the redirect should be handled by the most specific child route
  MAP_ROUTE.replaceParams({ zoom: 11 });

  return {
    // Route matching states
    map_matching: MAP_ROUTE.matching,
    isochrone_matching: MAP_ISOCHRONE_ROUTE.matching,
    compare_matching: MAP_ISOCHRONE_COMPARE_ROUTE.matching,

    // Track navigation calls
    nav_to_calls: navToCalls,

    // Expected: URL should preserve route structure and include the zoom parameter
    expected_redirect_url: "/map/isochrone/compare?zoom=11",

    // Actual result
    actual_redirect_url:
      navToCalls.length > 0 ? navToCalls[navToCalls.length - 1] : "none",

    // Test result - check if navigation happened to correct URL
    test_passes:
      navToCalls.length > 0 &&
      navToCalls[navToCalls.length - 1].includes("zoom=11"),
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```js
{
  "map_matching": true,
  "isochrone_matching": true,
  "compare_matching": true,
  "nav_to_calls": [
    "http://127.0.0.1/map/isochrone/compare?zoom=11"
  ],
  "expected_redirect_url": "/map/isochrone/compare?zoom=11",
  "actual_redirect_url": "http://127.0.0.1/map/isochrone/compare?zoom=11",
  "test_passes": true
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
