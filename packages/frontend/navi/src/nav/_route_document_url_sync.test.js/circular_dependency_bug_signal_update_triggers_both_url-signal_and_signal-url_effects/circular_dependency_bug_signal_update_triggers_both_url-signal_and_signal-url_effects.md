# [circular dependency bug: signal update triggers both URL->Signal and Signal->URL effects](../../route_document_url_sync.test.js)

```js
// Mock browser integration to capture navigation calls
let navToCalls = [];
setBrowserIntegration({
  navTo: (url, options = {}) => {
    navToCalls.push({ url, options });
    updateRoutes(url);
    return Promise.resolve();
  },
});

try {
  const categorySignal = stateSignal("electronics");
  const { CATEGORY_ROUTE } = setupRoutes({
    CATEGORY_ROUTE: `/products?category=${categorySignal}`,
  });
  // Navigate to initial URL - this should set signal to "electronics"
  updateRoutes(`${baseUrl}/products?category=electronics`);
  // Clear navigation calls from initial setup
  navToCalls = [];

  // BUG SCENARIO: Signal update should trigger Signal->URL effect only
  // But with circular dependency, it might trigger URL->Signal effect too
  categorySignal.value = "books";

  return {
    initialSignalValue: "electronics", // After URL parsing
    finalSignalValue: categorySignal.value, // After programmatic update
    navToCallsCount: navToCalls.length, // Should be 1 (Signal->URL only)
    navToCalls: navToCalls.map((call) => ({
      url: call.url,
      options: call.options,
    })),
    routeMatching: CATEGORY_ROUTE.matching,
    routeParams: CATEGORY_ROUTE.params,
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
  setBrowserIntegration(undefined);
}
```

```js
{
  "initialSignalValue": "electronics",
  "finalSignalValue": "books",
  "navToCallsCount": 1,
  "navToCalls": [
    {
      "url": "http://127.0.0.1/products?category=books",
      "options": {
        "replace": true
      }
    }
  ],
  "routeMatching": true,
  "routeParams": {
    "category": "books"
  }
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
