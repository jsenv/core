# [step parameter should prevent redundant navigation calls](../../route_document_url_sync.test.js)

```js
const navToCalls = [];
const routeIntegrationMock = {
  navTo: (url) => {
    navToCalls.push(url);
    updateRoutes(url);
    return Promise.resolve();
  },
};
setRouteIntegration(routeIntegrationMock);

try {
  const lonSignal = stateSignal(2.3, {
    id: "longitude",
    type: "longitude",
    step: 0.1,
  });
  const { MAP_ROUTE } = setupRoutes({
    MAP_ROUTE: `/map?lon=${lonSignal}`,
  });
  updateRoutes(`${baseUrl}/map?lon=2.3`);

  const captureState = () => {
    const navToCopy = [...navToCalls];
    navToCalls.length = 0;
    return {
      lon_signal_value: lonSignal.value,
      route_url: MAP_ROUTE.url,
      navToCalls: navToCopy,
    };
  };
  const results = {};

  // Test 1: Set values that round to the same step - should not trigger navigation
  lonSignal.value = 2.32; // Should round to 2.3 (same as current)
  results["after update signal to 2.32"] = captureState();

  lonSignal.value = 2.28; // Should round to 2.3 (same as current)
  results["after update signal to 2.28"] = captureState();

  // Test 2: Set value that rounds to different step - should trigger navigation
  lonSignal.value = 2.45; // Should round to 2.5 (different)
  results["after update signal to 2.45"] = captureState();

  // Test 3: Set another value that rounds to same new step - should not trigger
  lonSignal.value = 2.53; // Should round to 2.5 (same as current 2.5)
  results["after update signal to 2.53"] = captureState();

  // Test 4: Update URL directly with precise value and see how signal reacts
  updateRoutes(`${baseUrl}/map?lon=2.67`); // Should round signal to 2.7
  results["after update url to 2.67"] = captureState();

  lonSignal.value = 3;
  results["after update signal to 3"] = captureState();

  updateRoutes(`${baseUrl}/map?lon=3.000001`);
  results["after update url to 3.000001"] = captureState();

  return {
    setup: {
      lon_signal_default_value: 2.3,
    },
    results,
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
  setRouteIntegration(null);
}
```

```js
{
  "setup": {
    "lon_signal_default_value": 2.3
  },
  "results": {
    "after update signal to 2.32": {
      "lon_signal_value": 2.3,
      "route_url": "http://127.0.0.1/map",
      "navToCalls": []
    },
    "after update signal to 2.28": {
      "lon_signal_value": 2.3,
      "route_url": "http://127.0.0.1/map",
      "navToCalls": []
    },
    "after update signal to 2.45": {
      "lon_signal_value": 2.5,
      "route_url": "http://127.0.0.1/map?lon=2.5",
      "navToCalls": [
        "http://127.0.0.1/map?lon=2.5",
        "http://127.0.0.1/map?lon=2.5"
      ]
    },
    "after update signal to 2.53": {
      "lon_signal_value": 2.5,
      "route_url": "http://127.0.0.1/map?lon=2.5",
      "navToCalls": []
    },
    "after update url to 2.67": {
      "lon_signal_value": "2.67",
      "route_url": "http://127.0.0.1/map?lon=2.67",
      "navToCalls": []
    },
    "after update signal to 3": {
      "lon_signal_value": 3,
      "route_url": "http://127.0.0.1/map?lon=3",
      "navToCalls": [
        "http://127.0.0.1/map?lon=3",
        "http://127.0.0.1/map?lon=3"
      ]
    },
    "after update url to 3.000001": {
      "lon_signal_value": "3.000001",
      "route_url": "http://127.0.0.1/map?lon=3.000001",
      "navToCalls": []
    }
  }
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
