# [dynamic_defaults_inheritance_should_work](../../route_dynamic_defaults_inheritance.test.js)

```js
try {
  // Test case: dynamic defaults should be considered when inheriting parameters
  // and when filtering default values, not just static defaults
  
  const modeSignal = stateSignal("normal", {
    id: "mode",
    type: "string",
    // Dynamic default that changes based on time or other conditions
    getDefaultValue: () => {
      // Simulate dynamic default - could be based on time, user preference, etc.
      return new Date().getHours() > 12 ? "afternoon" : "morning";
    }
  });

  const categorySignal = stateSignal("general", {
    id: "category", 
    type: "string",
    defaultValue: "general", // Static default
    getDefaultValue: () => "general" // Same as static for this test
  });

  // Set signals to their current dynamic defaults
  const currentModeDefault = modeSignal.options.getDefaultValue();
  const currentCategoryDefault = categorySignal.options.getDefaultValue();
  
  modeSignal.value = currentModeDefault; // Should be considered default
  categorySignal.value = currentCategoryDefault; // Should be considered default
  
  const { PARENT_ROUTE, CHILD_ROUTE } = setupRoutes({
    PARENT_ROUTE: `/parent/:mode?${modeSignal}&category=${categorySignal}`,
    CHILD_ROUTE: `/parent/child/:tab?`
  });

  // Test 1: Child route should not inherit parameters that are at their dynamic defaults
  const childUrlWithDefaults = CHILD_ROUTE.buildUrl({ tab: "settings" });
  
  // Test 2: Change signals to non-default values
  modeSignal.value = "evening"; // Non-default value
  categorySignal.value = "special"; // Non-default value
  
  const childUrlWithCustomValues = CHILD_ROUTE.buildUrl({ tab: "settings" });
  
  // Test 3: Change dynamic default and verify behavior
  // Override getDefaultValue to return different dynamic default
  const originalGetDefault = modeSignal.options.getDefaultValue;
  modeSignal.options.getDefaultValue = () => "evening"; // New dynamic default
  
  // Now "evening" should be considered default
  const childUrlAfterDynamicDefaultChange = CHILD_ROUTE.buildUrl({ tab: "settings" });
  
  // Restore original
  modeSignal.options.getDefaultValue = originalGetDefault;

  return {
    currentModeDefault,
    currentCategoryDefault,
    childUrlWithDefaults, // Should be clean: /parent/child/settings (no query params for defaults)
    childUrlWithCustomValues, // Should include: /parent/child/settings?mode=evening&category=special  
    childUrlAfterDynamicDefaultChange // Should be clean again: /parent/child/settings (evening is now default)
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```console
TypeError: Cannot read properties of undefined (reading 'getDefaultValue')
  at base/route_dynamic_defaults_inheritance.test.js:30:53
  at capture (@jsenv/core/packages/tooling/snapshot/src/side_effects/create_capture_side_effects.js:342:29)
  at snapshotTests (@jsenv/core/packages/tooling/snapshot/src/side_effects/snapshot_tests.js:183:33)
  at async base/route_dynamic_defaults_inheritance.test.js:6:1
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
