# [url building with local storage mocking](../../route_build_url.test.js#L93)

```js
// Mock window.localStorage (required by valueInLocalStorage)
const localStorageMock = {
  storage: new Map(),
  getItem(key) {
    return this.storage.get(key) || null;
  },
  setItem(key, value) {
    this.storage.set(key, String(value));
  },
  removeItem(key) {
    this.storage.delete(key);
  },
  clear() {
    this.storage.clear();
  },
};

// Ensure window object exists and has localStorage
if (!globalThis.window) {
  globalThis.window = {};
}
globalThis.window.localStorage = localStorageMock;

try {
  // Set initial localStorage values
  localStorageMock.setItem("section_ls", "settings"); // default
  localStorageMock.setItem("settings_tab_ls", "general"); // default
  const sectionSignal = stateSignal("settings", {
    id: "section_ls",
    persists: true,
    type: "string",
  });
  const tabSignal = stateSignal("general", {
    id: "settings_tab_ls",
    persists: true,
    type: "string",
  });
  const { ADMIN_ROUTE, ADMIN_SETTINGS_ROUTE } = setupRoutes({
    ROOT: "/",
    ADMIN_ROUTE: `/admin/:section=${sectionSignal}/`,
    ADMIN_SETTINGS_ROUTE: `/admin/settings/:tab=${tabSignal}`,
  });

  const scenario1 = {
    name: "both_at_defaults",
    localStorage_section: localStorageMock.getItem("section_ls"), // null - cleaned up because value equals default
    localStorage_tab: localStorageMock.getItem("settings_tab_ls"), // null - cleaned up because value equals default
    signal_section: sectionSignal.value,
    signal_tab: tabSignal.value,
    admin_url: ADMIN_ROUTE.buildUrl({}),
    settings_url: ADMIN_SETTINGS_ROUTE.buildUrl({}),
  };

  // Change localStorage and signal values to non-defaults
  localStorageMock.setItem("section_ls", "users");
  localStorageMock.setItem("settings_tab_ls", "security");
  sectionSignal.value = "users"; // This should trigger localStorage update
  tabSignal.value = "security"; // This should trigger localStorage update

  const scenario2 = {
    name: "both_non_defaults",
    localStorage_section: localStorageMock.getItem("section_ls"),
    localStorage_tab: localStorageMock.getItem("settings_tab_ls"),
    signal_section: sectionSignal.value,
    signal_tab: tabSignal.value,
    admin_url: ADMIN_ROUTE.buildUrl({}),
    settings_url: ADMIN_SETTINGS_ROUTE.buildUrl({}),
  };

  // Test mixed scenario: section=settings (default), tab=security (non-default)
  localStorageMock.setItem("section_ls", "settings");
  localStorageMock.setItem("settings_tab_ls", "security");
  sectionSignal.value = "settings";
  tabSignal.value = "security";

  const scenario3 = {
    name: "section_default_tab_non_default",
    localStorage_section: localStorageMock.getItem("section_ls"), // null - cleaned up because value equals default
    localStorage_tab: localStorageMock.getItem("settings_tab_ls"),
    signal_section: sectionSignal.value,
    signal_tab: tabSignal.value,
    admin_url: ADMIN_ROUTE.buildUrl({}),
    settings_url: ADMIN_SETTINGS_ROUTE.buildUrl({}),
  };

  return {
    scenario1,
    scenario2,
    scenario3,
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
  delete globalThis.window;
}
```

```js
{
  "scenario1": {
    "name": "both_at_defaults",
    "localStorage_section": null,
    "localStorage_tab": null,
    "signal_section": "settings",
    "signal_tab": "general",
    "admin_url": "http://127.0.0.1/admin",
    "settings_url": "http://127.0.0.1/admin/settings"
  },
  "scenario2": {
    "name": "both_non_defaults",
    "localStorage_section": "users",
    "localStorage_tab": "security",
    "signal_section": "users",
    "signal_tab": "security",
    "admin_url": "http://127.0.0.1/admin/users",
    "settings_url": "http://127.0.0.1/admin/settings/security"
  },
  "scenario3": {
    "name": "section_default_tab_non_default",
    "localStorage_section": null,
    "localStorage_tab": "security",
    "signal_section": "settings",
    "signal_tab": "security",
    "admin_url": "http://127.0.0.1/admin/settings/security",
    "settings_url": "http://127.0.0.1/admin/settings/security"
  }
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
