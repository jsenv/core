# [parameterized route vs literal route conflict after navigation](../../route_url_sync.test.js#L197)

```js
try {
  const zoomSignal = stateSignal(10, {
    id: "conflictZoom",
    type: "number",
  });

  // Routes that create the conflict:
  // /map/ - base route with signal
  // /map/:panel/ - parameterized route 
  // /map/isochrone/ - literal route that conflicts with :panel
  const { MAP_ROUTE, MAP_PANEL_ROUTE, MAP_ISOCHRONE_ROUTE } = setupRoutes({
    MAP_ROUTE: `/map?zoom=${zoomSignal}`,
    MAP_PANEL_ROUTE: `/map/:panel`,
    MAP_ISOCHRONE_ROUTE: `/map/isochrone`,
  });

  const redirectCalls = [];

  // Mock all redirectTo methods to track delegation
  const mockRedirectTo = (routeName, originalRedirectTo) => (params) => {
    const route =
      routeName === "MAP_ROUTE"
        ? MAP_ROUTE
        : routeName === "MAP_PANEL_ROUTE"
          ? MAP_PANEL_ROUTE  
          : MAP_ISOCHRONE_ROUTE;

    redirectCalls.push({
      route: routeName,
      params,
      generatedUrl: route.buildUrl(params),
    });
    return originalRedirectTo.call(route, params);
  };

  const originalMethods = {
    map: MAP_ROUTE.redirectTo,
    panel: MAP_PANEL_ROUTE.redirectTo,
    isochrone: MAP_ISOCHRONE_ROUTE.redirectTo,
  };

  MAP_ROUTE.redirectTo = mockRedirectTo("MAP_ROUTE", originalMethods.map);
  MAP_PANEL_ROUTE.redirectTo = mockRedirectTo("MAP_PANEL_ROUTE", originalMethods.panel);
  MAP_ISOCHRONE_ROUTE.redirectTo = mockRedirectTo("MAP_ISOCHRONE_ROUTE", originalMethods.isochrone);

  // STEP 1: Navigate to /map/isochrone/ 
  // This should match both MAP_PANEL_ROUTE (:panel = "isochrone") AND MAP_ISOCHRONE_ROUTE
  updateRoutes(`${baseUrl}/map/isochrone`);

  const step1State = {
    map_matching: MAP_ROUTE.matching,
    panel_matching: MAP_PANEL_ROUTE.matching, 
    isochrone_matching: MAP_ISOCHRONE_ROUTE.matching,
  };

  // STEP 2: Navigate to /map/
  // Now we should be on the base route only
  updateRoutes(`${baseUrl}/map`);

  const step2State = {
    map_matching: MAP_ROUTE.matching,
    panel_matching: MAP_PANEL_ROUTE.matching,
    isochrone_matching: MAP_ISOCHRONE_ROUTE.matching,
  };

  // Clear redirect calls from navigation
  redirectCalls.length = 0;

  // STEP 3: Update the zoom signal
  // This should stay on /map/, not redirect to /map/isochrone/
  zoomSignal.value = 15;

  // Restore methods
  Object.assign(MAP_ROUTE, { redirectTo: originalMethods.map });
  Object.assign(MAP_PANEL_ROUTE, { redirectTo: originalMethods.panel });
  Object.assign(MAP_ISOCHRONE_ROUTE, { redirectTo: originalMethods.isochrone });

  return {
    step1_route_matching: step1State,
    step2_route_matching: step2State,
    
    // After signal update - should only redirect MAP_ROUTE to stay on /map
    final_redirect_calls: redirectCalls,
    
    // Expected behavior: Should stay on /map?zoom=15
    expected_redirect_route: "MAP_ROUTE",
    expected_url: "/map?zoom=15",
    
    // Actual behavior
    actual_redirect_route: redirectCalls.length > 0 ? redirectCalls[redirectCalls.length - 1].route : "none",
    actual_url: redirectCalls.length > 0 ? redirectCalls[redirectCalls.length - 1].generatedUrl : "none",
    
    // Problem indicator: If MAP_ISOCHRONE_ROUTE gets called, we have the bug
    bug_reproduced: redirectCalls.some(call => call.route === "MAP_ISOCHRONE_ROUTE"),
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```js
{
  "step1_route_matching": {
    "map_matching": false,
    "panel_matching": true,
    "isochrone_matching": true
  },
  "step2_route_matching": {
    "map_matching": true,
    "panel_matching": false,
    "isochrone_matching": false
  },
  "final_redirect_calls": [
    {
      "route": "MAP_ROUTE",
      "params": {
        "zoom": 15
      },
      "generatedUrl": "http://127.0.0.1/map?zoom=15"
    }
  ],
  "expected_redirect_route": "MAP_ROUTE",
  "expected_url": "/map?zoom=15",
  "actual_redirect_route": "MAP_ROUTE",
  "actual_url": "http://127.0.0.1/map?zoom=15",
  "bug_reproduced": false
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
