# [signal updates on parent route should delegate to child route](../../route_url_sync.test.js#L84)

```js
try {
  const zoomSignal = stateSignal(12, {
    id: "hierarchyZoom",
    type: "number",
  });

  const { MAP_ROUTE, MAP_ISOCHRONE_ROUTE, MAP_COMPARE_ROUTE } = setupRoutes({
    MAP_ROUTE: `/map?zoom=${zoomSignal}`,
    MAP_ISOCHRONE_ROUTE: "/map/isochrone",
    MAP_COMPARE_ROUTE: "/map/isochrone/compare",
  });

  // Start on deeply nested route
  updateRoutes(`${baseUrl}/map/isochrone/compare?zoom=15`);

  const redirectCalls = [];
  
  // Mock all redirectTo methods
  const mockRedirectTo = (routeName, originalRedirectTo) => (params) => {
    const route = routeName === "MAP_ROUTE" ? MAP_ROUTE : 
                 routeName === "MAP_ISOCHRONE_ROUTE" ? MAP_ISOCHRONE_ROUTE :
                 MAP_COMPARE_ROUTE;
    
    redirectCalls.push({
      route: routeName,
      params,
      generatedUrl: route.buildUrl(params),
    });
    return originalRedirectTo.call(route, params);
  };

  const originalMethods = {
    map: MAP_ROUTE.redirectTo,
    isochrone: MAP_ISOCHRONE_ROUTE.redirectTo,
    compare: MAP_COMPARE_ROUTE.redirectTo,
  };

  MAP_ROUTE.redirectTo = mockRedirectTo("MAP_ROUTE", originalMethods.map);
  MAP_ISOCHRONE_ROUTE.redirectTo = mockRedirectTo("MAP_ISOCHRONE_ROUTE", originalMethods.isochrone);
  MAP_COMPARE_ROUTE.redirectTo = mockRedirectTo("MAP_COMPARE_ROUTE", originalMethods.compare);

  // Trigger replaceParams on parent route (this would happen when signal changes)
  // This should delegate to the most specific matching route (MAP_COMPARE_ROUTE)
  MAP_ROUTE.replaceParams({ zoom: 20 });

  // Restore methods
  Object.assign(MAP_ROUTE, { redirectTo: originalMethods.map });
  Object.assign(MAP_ISOCHRONE_ROUTE, { redirectTo: originalMethods.isochrone });
  Object.assign(MAP_COMPARE_ROUTE, { redirectTo: originalMethods.compare });

  return {
    // Route matching states
    routes_matching: {
      map: MAP_ROUTE.matching,
      isochrone: MAP_ISOCHRONE_ROUTE.matching,
      compare: MAP_COMPARE_ROUTE.matching,
    },
    
    // Track which route handled the redirect
    redirect_calls: redirectCalls,
    
    // Verify the most specific route was used
    most_specific_route_used: redirectCalls.length > 0 ? redirectCalls[0].route : "none",
    
    // Expected: MAP_COMPARE_ROUTE should handle the redirect
    expected_most_specific: "MAP_COMPARE_ROUTE",
    
    // The URL that should be generated
    expected_url_pattern: "/map/isochrone/compare?zoom=20",
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

# 1/2 logs

```console
Cannot replace params on route route "/map?zoom" because it is not matching the current URL.
Cannot replace params on route route "/map?zoom" because it is not matching the current URL.
```

# 2/2 return

```js
{
  "routes_matching": {
    "map": false,
    "isochrone": false,
    "compare": true
  },
  "redirect_calls": [],
  "most_specific_route_used": "none",
  "expected_most_specific": "MAP_COMPARE_ROUTE",
  "expected_url_pattern": "/map/isochrone/compare?zoom=20"
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
