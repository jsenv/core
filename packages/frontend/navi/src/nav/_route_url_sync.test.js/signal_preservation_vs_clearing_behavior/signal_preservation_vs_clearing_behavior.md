# [signal preservation vs clearing behavior](../../route_url_sync.test.js)

```js
try {
  const panelSignal = stateSignal(undefined, {
    id: "preservationTestPanel",
    type: "string",
  });

  // Set initial value
  panelSignal.value = "isochrone";

  // Use a route pattern that can handle the panel parameter
  const { MAP_PANEL_ROUTE } = setupRoutes({
    MAP_PANEL_ROUTE: `/map/:panel={navi_state_signal:preservationTestPanel}`,
    HOME_ROUTE: `/home`,
  });

  // SCENARIO 1: Navigate to /map/isochrone - signal should match URL
  updateRoutes(`${baseUrl}/map/isochrone`);

  const scenario1 = {
    url: "/map/isochrone",
    panel_signal: panelSignal.value,
    panel_route_matches: MAP_PANEL_ROUTE.matching,
  };

  // SCENARIO 2: Navigate to /home - signal should be preserved (different route pattern)
  updateRoutes(`${baseUrl}/home`);

  const scenario2 = {
    url: "/home",
    panel_signal: panelSignal.value, // Should remain "isochrone"
    panel_route_matches: MAP_PANEL_ROUTE.matching, // Should be false
  };

  // SCENARIO 3: Navigate back to /map/settings - signal should update from URL
  updateRoutes(`${baseUrl}/map/settings`);

  const scenario3 = {
    url: "/map/settings",
    panel_signal: panelSignal.value, // Should be "settings"
    panel_route_matches: MAP_PANEL_ROUTE.matching, // Should be true
  };

  // SCENARIO 4: Reset signal manually, then navigate to /map/dashboard
  panelSignal.value = "manual-value";
  updateRoutes(`${baseUrl}/map/dashboard`);

  const scenario4 = {
    url: "/map/dashboard",
    panel_signal: panelSignal.value, // Should be "dashboard" (URL overrides)
    panel_route_matches: MAP_PANEL_ROUTE.matching,
  };

  return {
    scenario1_initial_navigation: scenario1,
    scenario2_preserve_on_different_route: scenario2,
    scenario3_update_from_url: scenario3,
    scenario4_url_overrides_manual_value: scenario4,

    // Key behaviors to verify:
    signal_updates_from_url_initially:
      scenario1.panel_signal === "isochrone",
    signal_preserved_on_different_route:
      scenario2.panel_signal === "isochrone",
    signal_updates_from_new_url: scenario3.panel_signal === "settings",
    url_overrides_manual_value: scenario4.panel_signal === "dashboard",

    // Route matching behavior
    routes_match_correctly: [
      scenario1.panel_route_matches, // true
      scenario2.panel_route_matches, // false
      scenario3.panel_route_matches, // true
      scenario4.panel_route_matches, // true
    ],
  };
} finally {
  clearAllRoutes();
  globalSignalRegistry.clear();
}
```

```js
{
  "scenario1_initial_navigation": {
    "url": "/map/isochrone",
    "panel_signal": "isochrone",
    "panel_route_matches": true
  },
  "scenario2_preserve_on_different_route": {
    "url": "/home",
    "panel_signal": "isochrone",
    "panel_route_matches": false
  },
  "scenario3_update_from_url": {
    "url": "/map/settings",
    "panel_signal": "settings",
    "panel_route_matches": true
  },
  "scenario4_url_overrides_manual_value": {
    "url": "/map/dashboard",
    "panel_signal": "dashboard",
    "panel_route_matches": true
  },
  "signal_updates_from_url_initially": true,
  "signal_preserved_on_different_route": true,
  "signal_updates_from_new_url": true,
  "url_overrides_manual_value": true,
  "routes_match_correctly": [
    true,
    false,
    true,
    true
  ]
}
```

---

<sub>
  Generated by <a href="https://github.com/jsenv/core/tree/main/packages/tooling/snapshot">@jsenv/snapshot</a>
</sub>
