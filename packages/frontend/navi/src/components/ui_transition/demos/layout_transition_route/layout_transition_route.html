<!doctype html>
<html>
  <head>
    <title>UITransition Size Demo with Routes</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
      }

      #root {
        width: 100%;
        height: 100%;
      }

      body {
        position: relative;
        margin: 0;
        padding: 0;
        color: white;
        font-family: system-ui;
        background:
          repeating-linear-gradient(
            45deg,
            transparent,
            transparent 100px,
            rgba(0, 0, 0, 0.05) 100px,
            rgba(0, 0, 0, 0.05) 200px
          ),
          linear-gradient(
            45deg,
            rgba(255, 255, 0, 0.8) 0%,
            rgba(255, 255, 0, 0.6) 100%
          );
      }

      body::before {
        position: fixed;
        top: 50%;
        left: 50%;
        z-index: -1;
        color: rgba(0, 0, 0, 0.1);
        font-weight: 900;
        font-size: 8rem;
        letter-spacing: 2rem;
        transform: translate(-50%, -50%) rotate(-45deg);
        pointer-events: none;
        content: "BODY";
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { useRef } from "preact/hooks";
      import {
        Layout,
        Link,
        Routes,
        Route,
        Box,
        RouteLink,
        setupRoutes,
        UITransition,
      } from "@jsenv/navi";

      const {
        DIALOG_ROUTE,
        VIEWPORT_ROUTE,
        VIEWPORT_OVERFLOW_X_ROUTE,
        VIEWPORT_OVERFLOW_Y_ROUTE,
        VIEWPORT_OVERFLOW_XY_ROUTE,
      } = setupRoutes({
        DIALOG_ROUTE: "",
        VIEWPORT_ROUTE: "viewport",
        VIEWPORT_OVERFLOW_X_ROUTE: "viewport_overflow_x",
        VIEWPORT_OVERFLOW_Y_ROUTE: "viewport_overflow_y",
        VIEWPORT_OVERFLOW_XY_ROUTE: "viewport_overflow_xy",
      });

      const Router = ({ uiTransitionRef }) => {
        return (
          <Routes element={<RootLayout uiTransitionRef={uiTransitionRef} />}>
            <Route element={<ViewportPage />} route={VIEWPORT_ROUTE} />
            <Route
              element={<ViewportOverflowXPage />}
              route={VIEWPORT_OVERFLOW_X_ROUTE}
            />
            <Route
              element={<ViewportOverflowYPage />}
              route={VIEWPORT_OVERFLOW_Y_ROUTE}
            />
            <Route
              element={<ViewportOverflowXYPage />}
              route={VIEWPORT_OVERFLOW_XY_ROUTE}
            />
            <Route
              meta={{ layout: "dialog" }}
              element={<SmallPage />}
              fallback
            />
          </Routes>
        );
      };

      const Nav = ({ uiTransitionRef }) => {
        return (
          <Layout
            as="nav"
            row
            contentSpacing="16"
            style="position: fixed; z-index: 1; top: 0; left: 0;"
          >
            <RouteLink route={DIALOG_ROUTE}>Dialog</RouteLink>
            <RouteLink route={VIEWPORT_ROUTE}>Viewport</RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_X_ROUTE}>
              Viewport x overflow
            </RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_Y_ROUTE}>
              Viewport y overflow
            </RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_XY_ROUTE}>
              Viewport overflow xy
            </RouteLink>

            <PauseControls uiTransitionRef={uiTransitionRef} />
          </Layout>
        );
      };

      const PauseControls = ({ uiTransitionRef }) => {
        return (
          <div style="background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px;">
            <label style="display: flex; align-items: center; gap: 8px; color: #333;">
              <input
                type="checkbox"
                id="pauseCheckbox"
                onChange={(e) => {
                  if (uiTransitionRef.current) {
                    if (e.target.checked) {
                      const pausePercentage =
                        document.querySelector("#pausePercentage").value;
                      uiTransitionRef.current.setPauseBreakpoints([
                        pausePercentage / 100,
                      ]);
                    } else {
                      uiTransitionRef.current.setPauseBreakpoints([]);
                    }
                  }
                }}
              />
              Pause at
              <input
                type="range"
                id="pausePercentage"
                min="1"
                max="99"
                value="80"
                style="width: 60px;"
                onInput={(e) => {
                  document.querySelector("#pauseLabel").textContent =
                    `${e.target.value}%`;
                }}
              />
              <span id="pauseLabel">80%</span>
            </label>
            <button
              id="resumeButton"
              style="margin-left: 8px; padding: 4px 8px; border: 1px solid #ccc; background: #f5f5f5; border-radius: 3px; cursor: pointer;"
              onClick={() => {
                if (window.resumeTransitions) {
                  window.resumeTransitions();
                }
              }}
            >
              Resume Transitions
            </button>
          </div>
        );
      };

      const RootLayout = ({ uiTransitionRef }) => {
        return (
          <>
            <UITransition
              uiTransitionRef={uiTransitionRef}
              duration="2000"
              debugDetection
              debugSize
              debugContent
            >
              <Route.Slot />
            </UITransition>
            <PauseControls uiTransitionRef={uiTransitionRef} />
          </>
        );
      };

      const DialogLayout = ({ children }) => {
        // We put paddings around the dialog to ensure window resizing respects this space
        // this way even narrow window will show some space around the dialog
        return (
          <Box id="dialog_layout" padding="40" color="#666">
            <Box background="white" minWidth="300" height="250" padding="20">
              {children}
            </Box>
          </Box>
        );
      };
      const ViewportLayout = ({ children }) => {
        return (
          <Box
            id="viewport_layout"
            minWidth="max-content"
            minHeight="max-content"
            width="100%"
            height="100%"
            row
            padding="40"
            background="white"
            color="#666"
          >
            {children}
          </Box>
        );
      };

      const SmallPage = () => <DialogLayout>300x250 with border</DialogLayout>;
      const ViewportPage = () => {
        return <ViewportLayout>Full page no border</ViewportLayout>;
      };
      const ViewportOverflowXPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_wide_page"
            minWidth="150vw"
            color="blue"
            size="lg"
            bold
          >
            Wide Page (150% viewport width)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );
      const ViewportOverflowYPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_tall_page"
            minHeight="150vh"
            padding="40"
            color="green"
            size="lg"
            bold
          >
            Tall Page (150% viewport height)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );
      const ViewportOverflowXYPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_tall_page"
            minWidth="150vw"
            minHeight="150vh"
            padding="40"
            color="green"
            size="lg"
            bold
          >
            Wide and tall Page (150% viewport width/height)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );

      const App = () => {
        const uiTransitionRef = useRef();

        return (
          <>
            <Nav uiTransitionRef={uiTransitionRef} />
            <Router />
          </>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
