<!doctype html>
<html>
  <head>
    <title>UITransition Size Demo with Routes</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }
      html,
      body {
        width: 100%;
        min-width: max-content;
        height: 100%;
        min-height: max-content;
      }

      #root {
        background: rgba(0, 0, 0, 0.5);
      }

      html,
      body,
      #root,
      #root_layout {
        width: 100%;
        min-width: max-content;
        height: 100%;
        min-height: max-content;
      }

      body {
        position: relative;
        margin: 0;
        padding: 0;
        color: white;
        font-family: system-ui;
        background:
          repeating-linear-gradient(
            45deg,
            transparent,
            transparent 100px,
            rgba(0, 0, 0, 0.05) 100px,
            rgba(0, 0, 0, 0.05) 200px
          ),
          linear-gradient(
            45deg,
            rgba(255, 255, 0, 0.8) 0%,
            rgba(255, 255, 0, 0.6) 100%
          );
      }

      body::before {
        position: fixed;
        top: 50%;
        left: 50%;
        z-index: -1;
        color: rgba(0, 0, 0, 0.1);
        font-weight: 900;
        font-size: 8rem;
        letter-spacing: 2rem;
        transform: translate(-50%, -50%) rotate(-45deg);
        pointer-events: none;
        content: "BODY";
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import {
        Layout,
        Link,
        Routes,
        Route,
        Box,
        RouteLink,
        setupRoutes,
        UITransition,
        useActiveRouteInfo,
      } from "@jsenv/navi";

      const {
        DIALOG_ROUTE,
        VIEWPORT_ROUTE,
        VIEWPORT_OVERFLOW_X_ROUTE,
        VIEWPORT_OVERFLOW_Y_ROUTE,
        VIEWPORT_OVERFLOW_XY_ROUTE,
      } = setupRoutes({
        DIALOG_ROUTE: "",
        VIEWPORT_ROUTE: "viewport",
        VIEWPORT_OVERFLOW_X_ROUTE: "viewport_overflow_x",
        VIEWPORT_OVERFLOW_Y_ROUTE: "viewport_overflow_y",
        VIEWPORT_OVERFLOW_XY_ROUTE: "viewport_overflow_xy",
      });

      const Router = () => {
        return (
          <Routes element={RootLayout}>
            <Route element={<ViewportPage />} route={VIEWPORT_ROUTE} />
            <Route
              element={<ViewportOverflowXPage />}
              route={VIEWPORT_OVERFLOW_X_ROUTE}
            />
            <Route
              element={<ViewportOverflowYPage />}
              route={VIEWPORT_OVERFLOW_Y_ROUTE}
            />
            <Route
              element={<ViewportOverflowXYPage />}
              route={VIEWPORT_OVERFLOW_XY_ROUTE}
            />
            <Route
              meta={{ layout: "fluid" }}
              element={<SmallPage />}
              fallback
            />
          </Routes>
        );
      };

      const Nav = () => {
        return (
          <Layout
            as="nav"
            row
            contentSpacing="16"
            style="position: fixed; z-index: 1"
          >
            <RouteLink route={DIALOG_ROUTE}>Dialog</RouteLink>
            <RouteLink route={VIEWPORT_ROUTE}>Viewport</RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_X_ROUTE}>
              Viewport x overflow
            </RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_Y_ROUTE}>
              Viewport y overflow
            </RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_XY_ROUTE}>
              Viewport overflow xy
            </RouteLink>
          </Layout>
        );
      };

      // <Box
      //         minWidth={fluid ? "auto" : "100%"}
      //         minHeight={fluid ? "auto" : "100%"}
      //         width="fit-content"
      //         height="fit-content"
      //         background="white"
      //         borderRadius={fluid ? "8" : undefined}
      //         border={fluid ? "5px solid orange" : "none"}
      //         color="#666"
      //       >
      //       </Box>

      const RootLayout = () => {
        const info = useActiveRouteInfo();
        const fluid = info.meta?.layout === "fluid";
        return (
          <Layout
            column
            as="main"
            id="root_layout"
            width="100%"
            height="100%"
            minHeight="max-content"
            background="rgba(0, 0, 160, 0.5)"
          >
            <UITransition
              // sizeTransition={false}
              sizeTransitionDuration="1000"
              debugDetection
              debugSize
              debugContent
              // transitionType="none"
              transitionDuration="800"
              fluid={fluid}
            >
              <Route.Slot />
            </UITransition>
          </Layout>
        );
      };

      const ViewportLayout = ({ children }) => {
        return (
          <Box
            id="viewport_page"
            minWidth="100%"
            width="fit-content"
            minHeight="100%"
            height="fit-content"
            padding="40"
          >
            {children}
          </Box>
        );
      };

      const SmallPage = () => (
        <Box id="fit_page" width="300" height="250" padding="40">
          300x250 with border
        </Box>
      );
      const ViewportPage = () => {
        return <ViewportLayout>Full page no border</ViewportLayout>;
      };
      const ViewportOverflowXPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_wide_page"
            minWidth="150vw"
            color="blue"
            size="lg"
            bold
          >
            Wide Page (150% viewport width)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );
      const ViewportOverflowYPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_tall_page"
            minHeight="150vh"
            padding="40"
            color="green"
            size="lg"
            bold
          >
            Tall Page (150% viewport height)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );
      const ViewportOverflowXYPage = () => (
        <Box
          id="viewport_tall_page"
          minWidth="150vw"
          minHeight="150vh"
          padding="40"
          color="green"
          size="lg"
          bold
        >
          Wide and tall Page (150% viewport width/height)
          <div>Extra content to make sure scrolling is possible</div>
          <div>Extra content to make sure scrolling is possible</div>
          <div>Extra content to make sure scrolling is possible</div>
        </Box>
      );

      const App = () => {
        return (
          <>
            <Nav />
            <Router />
          </>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
