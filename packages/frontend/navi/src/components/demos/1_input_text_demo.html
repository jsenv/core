<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input text demo</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { useState } from "preact/hooks";
      import {
        // eslint-disable-next-line no-unused-vars
        Field,
        // eslint-disable-next-line no-unused-vars
        Input,
        // eslint-disable-next-line no-unused-vars
        Form,
        // eslint-disable-next-line no-unused-vars
        Button,
        createAction,
      } from "@jsenv/navi";

      const sharedAction = createAction(async ({ greeting, name }) => {
        await new Promise((resolve) => {
          setTimeout(resolve, 2000);
        });
        throw new Error(`${greeting} ${name}`);
      }).bindParams({ greeting: "hello" });

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <>
            <div style="display: flex; flex-direction: row; gap: 30px">
              <div>
                <p>
                  <strong>Outside form</strong>
                </p>
                <div>
                  <Field
                    label="Test"
                    input={
                      <Input
                        id="outside_form"
                        name="outsideForm"
                        action={async ({ outsideForm }) => {
                          await new Promise((resolve) =>
                            setTimeout(resolve, 1_000),
                          );
                          throw new Error(`test: ${outsideForm}`);
                        }}
                      />
                    }
                  ></Field>
                </div>
              </div>

              <div>
                <p>
                  <strong>Outside form with initial value</strong>
                </p>

                <div>
                  <Input
                    name="outsideFormWithInitialValue"
                    value="initial"
                    action={async ({ outsideFormWithInitialValue }) => {
                      await new Promise((resolve) =>
                        setTimeout(resolve, 1_000),
                      );
                      // eslint-disable-next-line no-alert
                      window.alert(`test: ${outsideFormWithInitialValue}`);
                    }}
                  />
                </div>
              </div>

              <div>
                <p>
                  <strong>Outside form using action</strong>
                </p>
                <div>
                  <Input name="outsideFormUsingAction" action={actionA} />
                </div>
              </div>
            </div>
            <div style="display: flex; flex-direction: row; gap: 30px">
              <div>
                <p>
                  <strong>Inside form</strong>
                </p>
                <div>
                  <Form
                    action={async ({ insideForm }) => {
                      await new Promise((resolve) =>
                        setTimeout(resolve, 1_500),
                      );
                      throw new Error(`test: ${insideForm}`);
                    }}
                  >
                    <Input name="insideForm" />
                  </Form>
                </div>
              </div>
              <div>
                <p>
                  <strong>Inside form with submit and reset</strong>
                </p>
                <div>
                  <Form
                    action={async ({ insideFormWithSubmitAndReset }) => {
                      await new Promise((resolve) =>
                        setTimeout(resolve, 1_500),
                      );
                      throw new Error(`test: ${insideFormWithSubmitAndReset}`);
                    }}
                  >
                    <Input id="tototo" name="insideFormWithSubmitAndReset" />
                    <Button type="submit">Submit</Button>
                    <Button type="reset">Reset</Button>
                  </Form>
                </div>
              </div>
            </div>
            <div style="display: flex; flex-direction: row; gap: 30px">
              <div>
                <p>
                  <strong>2 input for the same action</strong>
                </p>
                <Input
                  name="name"
                  action={sharedAction}
                  label="Test"
                  style="color: blue"
                ></Input>
                <Input
                  name="name"
                  action={sharedAction}
                  label="Test"
                  style="color: blue"
                ></Input>
              </div>
            </div>
            <div>
              <p>
                <strong>Input number with action updating state</strong>
              </p>

              <InputNumberWithActionUpdatingState />
            </div>
          </>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputNumberWithActionUpdatingState = () => {
        const [value, setValue] = useState(1);

        return (
          <div>
            value: {value}
            <br />
            <Input
              type="number"
              value={value}
              name="test"
              action={({ test }) => {
                console.log("action executed with", test);

                setValue(test);
              }}
            />
          </div>
        );
      };

      const actionA = createAction(async ({ outsideFormUsingAction }) => {
        await new Promise((resolve) => setTimeout(resolve, 1_000));
        throw new Error(`test: ${outsideFormUsingAction}`);
      });

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
