<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Text Demo</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .demo-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .demo-title {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 16px;
        font-weight: 600;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 8px;
      }
      .result-display {
        margin-top: 15px;
        padding: 12px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        min-height: 20px;
        font-family: monospace;
        font-size: 14px;
      }
      .result-success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .result-error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .result-loading {
        background: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
      }
      nav a {
        color: #007bff;
        text-decoration: none;
      }
      nav a:hover {
        text-decoration: underline;
      }
      h2 {
        margin-top: 40px;
        margin-bottom: 20px;
        padding-top: 20px;
        border-top: 2px solid #e0e0e0;
      }
      h2:first-of-type {
        margin-top: 0;
        border-top: none;
        padding-top: 0;
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }
      button {
        padding: 8px 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f8f9fa;
      }
      .control-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 15px;
        font-weight: 500;
        color: #555;
      }
      label input {
        display: block;
        margin-top: 5px;
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <h1>Input Text Demo</h1>
    <div id="root"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { useState } from "preact/hooks";
      import {
        // eslint-disable-next-line no-unused-vars
        Input,
        // eslint-disable-next-line no-unused-vars
        Form,
        // eslint-disable-next-line no-unused-vars
        Button,
      } from "@jsenv/navi";

      const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

      // eslint-disable-next-line no-unused-vars
      const BasicInputNoActionDemo = () => {
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Basic Input (No Action)</h3>
            <div className="control-group">
              <label>
                Enter some text:
                <Input
                  name="text"
                  placeholder="Type something..."
                  onUIStateChange={(text) => {
                    setResult(text ? `Current value: "${text}"` : "");
                  }}
                />
              </label>
            </div>
            <div className="result-display">
              {result || "Type in the input to see the value..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithDefaultValueDemo = () => {
        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with Default Value</h3>
            <div className="control-group">
              <label>
                Input with default value:
                <Input
                  name="text"
                  defaultValue="Hello World!"
                  placeholder="Enter text..."
                />
              </label>
            </div>
            <div className="result-display">
              Input starts with default value.
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputControlledDemo = () => {
        const [value, setValue] = useState("Controlled input");
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Controlled Input</h3>
            <div className="control-group">
              <label>
                Controlled input:
                <Input
                  name="text"
                  value={value}
                  onUIStateChange={(text) => {
                    setValue(text);
                    setResult(
                      text ? `Value set to: "${text}"` : "Value cleared",
                    );
                  }}
                />
              </label>
            </div>
            <div className="button-group">
              <button onClick={() => setValue("Preset Text 1")}>
                Set Text 1
              </button>
              <button onClick={() => setValue("Preset Text 2")}>
                Set Text 2
              </button>
              <button onClick={() => setValue("")}>Clear</button>
            </div>
            <div className="result-display">
              {result || "Use buttons to control the input value..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <>
            <div className="demo-card" style={{ marginBottom: "30px" }}>
              <h2>Input Text Demo - Overview</h2>
              <p>
                This demo showcases different ways to use the Input component
                with text inputs.
              </p>
              <nav>
                <h3>Sections:</h3>
                <ul style={{ marginLeft: "20px" }}>
                  <li>
                    <a href="#basic-inputs">
                      1. Basic Input (no action/no form)
                    </a>{" "}
                    - Simple inputs with value handling
                  </li>
                  <li>
                    <a href="#input-actions">2. Input with Actions</a> - Inputs
                    that trigger actions on value change, including error
                    handling
                  </li>
                  <li>
                    <a href="#input-forms">3. Input inside Form</a> - Form
                    integration patterns
                  </li>
                </ul>
              </nav>
            </div>

            <h2 id="basic-inputs">1. Basic Input (no action/no form)</h2>
            <div className="demo-grid">
              <BasicInputNoActionDemo />
              <InputWithDefaultValueDemo />
              <InputControlledDemo />
            </div>

            <h2 id="input-actions">2. Input with Actions</h2>
            <div className="demo-grid">
              <BasicInputDemo />
              <InputWithInitialValueDemo />
              <InputWithExternalControlDemo />
              <InputWithErrorDemo />
              <InputWithValidationErrorDemo />
            </div>

            <h2 id="input-forms">3. Input inside Form</h2>
            <div className="demo-grid">
              <FormInputDemo />
              <FormInputErrorDemo />
            </div>
          </>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithErrorDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with Action (Always Fails)</h3>
            <div className="control-group">
              <label>
                Enter text (will always fail):
                <Input
                  name="text"
                  placeholder="Type something..."
                  action={async (text) => {
                    setIsLoading(true);
                    setResult("Processing...");
                    try {
                      await delay(1200);
                      throw new Error(`Processing failed for input: "${text}"`);
                    } catch (error) {
                      setResult(`❌ ${error.message}`);
                      throw error;
                    } finally {
                      setIsLoading(false);
                    }
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("❌") ? "result-error" : ""}`}
            >
              {result || "This input action will always fail..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithValidationErrorDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        return (
          <div className="demo-card">
            <h3 className="demo-title">
              Input with Validation (Fails on Short Text)
            </h3>
            <div className="control-group">
              <label>
                Enter text (min 5 characters):
                <Input
                  name="text"
                  placeholder="Must be at least 5 characters..."
                  action={async (text) => {
                    setIsLoading(true);
                    setResult("Validating...");
                    try {
                      await delay(800);
                      if (!text || text.length < 5) {
                        throw new Error(
                          "Text must be at least 5 characters long",
                        );
                      }
                      const response = `✅ Valid input: "${text}" (${text.length} characters)`;
                      setResult(response);
                      return response;
                    } catch (error) {
                      setResult(`❌ Validation failed: ${error.message}`);
                      throw error;
                    } finally {
                      setIsLoading(false);
                    }
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("✅") ? "result-success" : result.startsWith("❌") ? "result-error" : ""}`}
            >
              {result || "Enter at least 5 characters to pass validation..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const BasicInputDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        return (
          <div className="demo-card">
            <h3 className="demo-title">Basic Input with Action</h3>
            <div className="control-group">
              <label>
                Enter some text:
                <Input
                  name="text"
                  placeholder="Type something..."
                  action={async (text) => {
                    setIsLoading(true);
                    setResult("Processing...");
                    try {
                      await delay(1000);
                      const response = `✅ Processed: "${text}"`;
                      setResult(response);
                      return response;
                    } catch (error) {
                      setResult(`❌ Error: ${error.message}`);
                      throw error;
                    } finally {
                      setIsLoading(false);
                    }
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("✅") ? "result-success" : result.startsWith("❌") ? "result-error" : ""}`}
            >
              {result || "Result will appear here..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithInitialValueDemo = () => {
        const [value, setValue] = useState("Hello World!");
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with Initial Value</h3>
            <div className="control-group">
              <label>
                Input with preset value:
                <Input
                  name="text"
                  value={value}
                  onUIStateChange={setValue}
                  action={async (text) => {
                    setResult("Processing...");
                    await delay(800);
                    const response = `✅ Submitted: "${text}"`;
                    setResult(response);
                    return response;
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${result.startsWith("✅") ? "result-success" : ""}`}
            >
              {result || "Submit to see result..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithExternalControlDemo = () => {
        const [value, setValue] = useState(undefined);
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with External Control</h3>
            <div className="control-group">
              <label>
                Externally controlled input:
                <Input
                  name="text"
                  value={value}
                  placeholder="Use buttons below to set value"
                  action={async (text) => {
                    setResult("Processing...");
                    await delay(600);
                    const response = `✅ Action executed with: "${text}"`;
                    setResult(response);
                    return response;
                  }}
                />
              </label>
            </div>
            <div className="button-group">
              <button
                onClick={() => {
                  setValue("Preset Value 1");
                }}
              >
                Set Value 1
              </button>
              <button
                onClick={() => {
                  setValue("Preset Value 2");
                }}
              >
                Set Value 2
              </button>
              <button
                onClick={() => {
                  setValue("");
                }}
              >
                Clear
              </button>
            </div>
            <div
              className={`result-display ${result.startsWith("✅") ? "result-success" : ""}`}
            >
              Current value: "{value}"<br />
              {result || "Click buttons to change value, then submit..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const FormInputDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        const formDemoAction = async ({ username, email }) => {
          setIsLoading(true);
          setResult("Submitting form...");
          try {
            await delay(1200);
            const response = `✅ Form submitted!\nUsername: ${username}\nEmail: ${email}`;
            setResult(response);
            return response;
          } catch (error) {
            setResult(`❌ Form error: ${error.message}`);
            throw error;
          } finally {
            setIsLoading(false);
          }
        };

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input inside Form</h3>
            <Form action={formDemoAction}>
              <div className="control-group">
                <label>
                  Username:
                  <Input name="username" placeholder="Enter username" />
                </label>
              </div>
              <div className="control-group"></div>
              <div className="button-group">
                <Button type="submit">Submit Form</Button>
                <Button type="reset">Reset</Button>
              </div>
            </Form>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("✅") ? "result-success" : result.startsWith("❌") ? "result-error" : ""}`}
            >
              {result || "Fill form and submit..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const FormInputErrorDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        const formErrorAction = async ({ username, email }) => {
          setIsLoading(true);
          setResult("Submitting form...");
          try {
            await delay(1000);
            // Simulate server-side validation errors
            if (!username || username.length < 3) {
              throw new Error("Username must be at least 3 characters long");
            }
            if (username === "admin") {
              throw new Error(
                "Username 'admin' is reserved and cannot be used",
              );
            }
            // This will never be reached due to the conditions above
            const response = `✅ Form submitted!\nUsername: ${username}\nEmail: ${email}`;
            setResult(response);
            return response;
          } catch (error) {
            setResult(`❌ Form error: ${error.message}`);
            throw error;
          } finally {
            setIsLoading(false);
          }
        };

        return (
          <div className="demo-card">
            <h3 className="demo-title">Form with Validation Errors</h3>
            <p
              style={{ fontSize: "14px", color: "#666", marginBottom: "15px" }}
            >
              This form demonstrates server-side validation errors. Try: empty
              fields, username &lt; 3 chars, invalid email, or "admin" username.
            </p>
            <Form action={formErrorAction}>
              <div className="control-group">
                <label>
                  Username:
                  <Input
                    name="username"
                    placeholder="Enter username (try 'admin' or < 3 chars)"
                  />
                </label>
              </div>
              <div className="button-group">
                <Button type="submit">Submit Form</Button>
                <Button type="reset">Reset</Button>
              </div>
            </Form>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("✅") ? "result-success" : result.startsWith("❌") ? "result-error" : ""}`}
            >
              {result || "Fill form and submit to see validation errors..."}
            </div>
          </div>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
