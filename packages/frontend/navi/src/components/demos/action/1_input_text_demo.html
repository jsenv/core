<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Text Demo</title>
    <style>
      body {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        background: #f5f5f5;
      }
      .demo-grid {
        display: grid;
        margin-bottom: 30px;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
      }
      .demo-card {
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .demo-title {
        margin: 0 0 15px 0;
        padding-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 16px;
        border-bottom: 2px solid #e0e0e0;
      }
      .result-display {
        min-height: 20px;
        margin-top: 15px;
        padding: 12px;
        font-size: 14px;
        font-family: monospace;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
      }
      .result-success {
        color: #155724;
        background: #d4edda;
        border-color: #c3e6cb;
      }
      .result-error {
        color: #721c24;
        background: #f8d7da;
        border-color: #f5c6cb;
      }
      .result-loading {
        color: #0c5460;
        background: #d1ecf1;
        border-color: #bee5eb;
      }
      nav a {
        color: #007bff;
        text-decoration: none;
      }
      nav a:hover {
        text-decoration: underline;
      }
      h2 {
        margin-top: 40px;
        margin-bottom: 20px;
        padding-top: 20px;
        border-top: 2px solid #e0e0e0;
      }
      h2:first-of-type {
        margin-top: 0;
        padding-top: 0;
        border-top: none;
      }
      .button-group {
        display: flex;
        margin-top: 10px;
        gap: 10px;
      }
      button {
        padding: 8px 16px;
        font-size: 14px;
        background: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #f8f9fa;
      }
      .control-group {
        margin-bottom: 15px;
      }
      label {
        margin-bottom: 15px;
        color: #555;
        font-weight: 500;
      }
      label input {
        margin-left: 5px;
        padding: 8px 12px;
      }
    </style>
  </head>
  <body>
    <h1>Input Text Demo</h1>
    <div id="root"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { useState } from "preact/hooks";
      import {
        // eslint-disable-next-line no-unused-vars
        Input,
        // eslint-disable-next-line no-unused-vars
        Form,
        // eslint-disable-next-line no-unused-vars
        Button,
      } from "@jsenv/navi";

      const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <>
            <div className="demo-card" style={{ marginBottom: "30px" }}>
              <h2>Input Text Demo - Overview</h2>
              <p>
                This demo showcases different ways to use the Input component
                with text inputs.
              </p>
              <nav>
                <h3>Sections:</h3>
                <ul style={{ marginLeft: "20px" }}>
                  <li>
                    <a href="#basic-inputs">
                      1. Basic Input (no action/no form)
                    </a>{" "}
                    - Simple inputs with value handling
                  </li>
                  <li>
                    <a href="#input-actions">2. Input with Actions</a> - Inputs
                    that trigger actions on value change, including error
                    handling
                  </li>
                  <li>
                    <a href="#input-forms">3. Input inside Form</a> - Form
                    integration patterns
                  </li>
                  <li>
                    <a href="#datetime-local">4. Datetime-Local Inputs</a> -
                    Special handling for datetime inputs with timezone
                    conversion
                  </li>
                </ul>
              </nav>
            </div>

            <h2 id="basic-inputs">1. Basic Input (no action/no form)</h2>
            <div className="demo-grid">
              <BasicInputNoActionDemo />
              <InputWithDefaultValueDemo />
            </div>

            <h2 id="input-actions">2. Input with Actions</h2>
            <div className="demo-grid">
              <BasicInputDemo />
              <InputWithInitialValueDemo />
              <InputWithExternalControlDemo />
              <InputWithErrorDemo />
              <InputWithValidationErrorDemo />
            </div>

            <h2 id="input-forms">3. Input inside Form</h2>
            <div className="demo-grid">
              <FormInputDemo />
              <FormInputErrorDemo />
            </div>

            <h2 id="datetime-local">4. Datetime-Local Inputs</h2>
            <div className="demo-grid">
              <DateTimeLocalDemo />
              <DateTimeLocalFormDemo />
            </div>
          </>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const DateTimeLocalDemo = () => {
        // External state (what the server/app knows) - stored as UTC ISO string
        const [externalDateTime, setExternalDateTime] = useState(
          "2024-01-15T14:30:00Z", // UTC time
        );

        // UI state tracking
        const [uiDateTime, setUiDateTime] = useState(externalDateTime);
        const [actionValue, setActionValue] = useState("");
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        const saveDateTime = async (dateTimeValue) => {
          setIsLoading(true);
          setActionValue(dateTimeValue || "(empty)");
          setResult("Saving datetime...");
          try {
            await delay(1000);

            // Simulate server response
            const response = {
              saved: dateTimeValue,
              message: `Datetime saved successfully`,
            };

            // Update external state to match what was saved
            setExternalDateTime(dateTimeValue);
            setResult(`‚úÖ ${response.message}\\nSaved: ${dateTimeValue}`);
            return response;
          } catch (error) {
            setResult(`‚ùå Save failed: ${error.message}`);
            throw error;
          } finally {
            setIsLoading(false);
          }
        };

        return (
          <div className="demo-card">
            <h3 className="demo-title">Datetime-Local State Demo</h3>

            {/* External State Control */}
            <div
              style={{
                marginBottom: "20px",
                padding: "12px",
                background: "#e3f2fd",
                borderRadius: "4px",
              }}
            >
              <h4
                style={{
                  margin: "0 0 10px 0",
                  fontSize: "14px",
                  color: "#1976d2",
                }}
              >
                üìä External State (UTC)
              </h4>
              <div
                style={{
                  fontFamily: "monospace",
                  fontSize: "12px",
                  marginBottom: "10px",
                }}
              >
                Current: {externalDateTime || "(not set)"}
              </div>
              <div style={{ display: "flex", gap: "8px", flexWrap: "wrap" }}>
                <button
                  onClick={() => setExternalDateTime("2024-01-15T14:30:00Z")}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Set Jan 15, 2:30 PM UTC
                </button>
                <button
                  onClick={() => setExternalDateTime("2024-12-25T09:00:00Z")}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Set Dec 25, 9:00 AM UTC
                </button>
                <button
                  onClick={() => setExternalDateTime(null)}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Clear
                </button>
              </div>
            </div>

            {/* UI Input */}
            <div className="control-group">
              <label>
                Datetime Input (Local Time):
                <Input
                  type="datetime-local"
                  name="datetime"
                  value={externalDateTime} // External state controls the input
                  onUIStateChange={(datetime) => {
                    setUiDateTime(datetime);
                  }}
                  action={saveDateTime}
                />
              </label>
            </div>

            {/* State Display */}
            <div style={{ marginBottom: "15px" }}>
              <div
                style={{ fontSize: "12px", color: "#666", marginBottom: "8px" }}
              >
                <strong>UI State:</strong> {uiDateTime || "(empty)"}
              </div>
              <div
                style={{ fontSize: "12px", color: "#666", marginBottom: "8px" }}
              >
                <strong>Action receives:</strong>{" "}
                {actionValue || "(waiting for action...)"}
              </div>
            </div>

            <div
              className={`result-display ${
                isLoading
                  ? "result-loading"
                  : result.startsWith("‚úÖ")
                    ? "result-success"
                    : result.startsWith("‚ùå")
                      ? "result-error"
                      : ""
              }`}
            >
              {result ||
                "Change the datetime and blur/enter to trigger action..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const DateTimeLocalFormDemo = () => {
        const [externalDateTime, setExternalDateTime] = useState(
          "2024-06-01T10:00:00Z",
        );
        const [uiDateTime, setUiDateTime] = useState(externalDateTime);
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        const submitForm = async (formData) => {
          setIsLoading(true);
          setResult("Submitting form...");
          try {
            await delay(1200);

            const response = {
              datetime: formData.appointmentTime,
              message: "Appointment scheduled successfully",
            };

            // Update external state
            setExternalDateTime(formData.appointmentTime);
            setResult(
              `‚úÖ ${response.message}\\nScheduled for: ${formData.appointmentTime}`,
            );
            return response;
          } catch (error) {
            setResult(`‚ùå Form error: ${error.message}`);
            throw error;
          } finally {
            setIsLoading(false);
          }
        };

        const getResetValue = () => {
          return externalDateTime || "(not set)";
        };

        return (
          <div className="demo-card">
            <h3 className="demo-title">Datetime-Local in Form</h3>

            {/* External State Control */}
            <div
              style={{
                marginBottom: "20px",
                padding: "12px",
                background: "#e3f2fd",
                borderRadius: "4px",
              }}
            >
              <h4
                style={{
                  margin: "0 0 10px 0",
                  fontSize: "14px",
                  color: "#1976d2",
                }}
              >
                üìä External State Control (UTC)
              </h4>
              <div
                style={{
                  fontFamily: "monospace",
                  fontSize: "12px",
                  marginBottom: "10px",
                }}
              >
                Current: {externalDateTime || "(not set)"}
              </div>
              <div style={{ display: "flex", gap: "8px", flexWrap: "wrap" }}>
                <button
                  onClick={() => setExternalDateTime("2024-03-15T09:00:00Z")}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Set Mar 15, 9:00 AM UTC
                </button>
                <button
                  onClick={() => setExternalDateTime("2024-08-20T16:30:00Z")}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Set Aug 20, 4:30 PM UTC
                </button>
                <button
                  onClick={() => setExternalDateTime("2024-12-31T23:59:00Z")}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Set New Year's Eve
                </button>
                <button
                  onClick={() => setExternalDateTime(null)}
                  style={{ padding: "4px 8px", fontSize: "12px" }}
                >
                  Clear
                </button>
              </div>
            </div>

            <Form action={submitForm}>
              <div className="control-group">
                <label>
                  Appointment Time:
                  <Input
                    type="datetime-local"
                    name="appointmentTime"
                    value={externalDateTime}
                    onUIStateChange={setUiDateTime}
                  />
                </label>
              </div>

              <div
                style={{
                  fontSize: "12px",
                  color: "#666",
                  marginBottom: "10px",
                }}
              >
                <strong>UI State:</strong> {uiDateTime || "(empty)"}
              </div>

              <div className="button-group">
                <Button type="submit">
                  Schedule Appointment
                  {uiDateTime && (
                    <span style={{ fontSize: "11px", opacity: "0.7" }}>
                      {" "}
                      ({uiDateTime})
                    </span>
                  )}
                </Button>
                <Button type="reset">
                  Reset to Saved
                  <span style={{ fontSize: "11px", opacity: "0.7" }}>
                    {" "}
                    ({getResetValue()})
                  </span>
                </Button>
              </div>
            </Form>

            <div
              className={`result-display ${
                isLoading
                  ? "result-loading"
                  : result.startsWith("‚úÖ")
                    ? "result-success"
                    : result.startsWith("‚ùå")
                      ? "result-error"
                      : ""
              }`}
            >
              {result || "Select a datetime and submit..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const BasicInputNoActionDemo = () => {
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Basic Input (No Action)</h3>
            <div className="control-group">
              <label>
                Enter some text:
                <Input
                  name="text"
                  placeholder="Type something..."
                  onUIStateChange={(text) => {
                    setResult(text ? `Current value: "${text}"` : "");
                  }}
                />
              </label>
            </div>
            <div className="result-display">
              {result || "Type in the input to see the value..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithDefaultValueDemo = () => {
        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with Default Value</h3>
            <div className="control-group">
              <label>
                Input with default value:
                <Input
                  name="text"
                  defaultValue="Hello World!"
                  placeholder="Enter text..."
                />
              </label>
            </div>
            <div className="result-display">
              Input starts with default value.
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithErrorDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with Action (Always Fails)</h3>
            <div className="control-group">
              <label>
                Enter text (will always fail):
                <Input
                  name="text"
                  placeholder="Type something..."
                  action={async (text) => {
                    setIsLoading(true);
                    setResult("Processing...");
                    try {
                      await delay(1200);
                      throw new Error(`Processing failed for input: "${text}"`);
                    } catch (error) {
                      setResult(`‚ùå ${error.message}`);
                      throw error;
                    } finally {
                      setIsLoading(false);
                    }
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("‚ùå") ? "result-error" : ""}`}
            >
              {result || "This input action will always fail..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithValidationErrorDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        return (
          <div className="demo-card">
            <h3 className="demo-title">
              Input with Validation (Fails on Short Text)
            </h3>
            <div className="control-group">
              <label>
                Enter text (min 5 characters):
                <Input
                  name="text"
                  placeholder="Must be at least 5 characters..."
                  action={async (text) => {
                    setIsLoading(true);
                    setResult("Validating...");
                    try {
                      await delay(800);
                      if (!text || text.length < 5) {
                        throw new Error(
                          "Text must be at least 5 characters long",
                        );
                      }
                      const response = `‚úÖ Valid input: "${text}" (${text.length} characters)`;
                      setResult(response);
                      return response;
                    } catch (error) {
                      setResult(`‚ùå Validation failed: ${error.message}`);
                      throw error;
                    } finally {
                      setIsLoading(false);
                    }
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("‚úÖ") ? "result-success" : result.startsWith("‚ùå") ? "result-error" : ""}`}
            >
              {result || "Enter at least 5 characters to pass validation..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const BasicInputDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        return (
          <div className="demo-card">
            <h3 className="demo-title">Basic Input with Action</h3>
            <div className="control-group">
              <label>
                Enter some text:
                <Input
                  name="text"
                  placeholder="Type something..."
                  action={async (text) => {
                    setIsLoading(true);
                    setResult("Processing...");
                    try {
                      await delay(1000);
                      const response = `‚úÖ Processed: "${text}"`;
                      setResult(response);
                      return response;
                    } catch (error) {
                      setResult(`‚ùå Error: ${error.message}`);
                      throw error;
                    } finally {
                      setIsLoading(false);
                    }
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("‚úÖ") ? "result-success" : result.startsWith("‚ùå") ? "result-error" : ""}`}
            >
              {result || "Result will appear here..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithInitialValueDemo = () => {
        const [value, setValue] = useState("Hello World!");
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with Initial Value</h3>
            <div className="control-group">
              <label>
                Input with preset value:
                <Input
                  name="text"
                  value={value}
                  onUIStateChange={setValue}
                  action={async (text) => {
                    setResult("Processing...");
                    await delay(800);
                    const response = `‚úÖ Submitted: "${text}"`;
                    setResult(response);
                    return response;
                  }}
                />
              </label>
            </div>
            <div
              className={`result-display ${result.startsWith("‚úÖ") ? "result-success" : ""}`}
            >
              {result || "Submit to see result..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const InputWithExternalControlDemo = () => {
        const [value, setValue] = useState(undefined);
        const [result, setResult] = useState("");

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input with External Control</h3>
            <div className="control-group">
              <label>
                Externally controlled input:
                <Input
                  name="text"
                  value={value}
                  placeholder="Use buttons below to set value"
                  action={async (text) => {
                    setResult("Processing...");
                    await delay(600);
                    const response = `‚úÖ Action executed with: "${text}"`;
                    setResult(response);
                    setValue(text);
                    return response;
                  }}
                />
              </label>
            </div>
            <div className="button-group">
              <button
                onClick={() => {
                  setValue("Preset Value 1");
                }}
              >
                Set Value 1
              </button>
              <button
                onClick={() => {
                  setValue("Preset Value 2");
                }}
              >
                Set Value 2
              </button>
              <button
                onClick={() => {
                  setValue("");
                }}
              >
                Clear
              </button>
            </div>
            <div
              className={`result-display ${result.startsWith("‚úÖ") ? "result-success" : ""}`}
            >
              Current value: "{value}"<br />
              {result || "Click buttons to change value, then submit..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const FormInputDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        const formDemoAction = async ({ username, email }) => {
          setIsLoading(true);
          setResult("Submitting form...");
          try {
            await delay(1200);
            const response = `‚úÖ Form submitted!\nUsername: ${username}\nEmail: ${email}`;
            setResult(response);
            return response;
          } catch (error) {
            setResult(`‚ùå Form error: ${error.message}`);
            throw error;
          } finally {
            setIsLoading(false);
          }
        };

        return (
          <div className="demo-card">
            <h3 className="demo-title">Input inside Form</h3>
            <Form action={formDemoAction}>
              <div className="control-group">
                <label>
                  Username:
                  <Input name="username" placeholder="Enter username" />
                </label>
              </div>
              <div className="control-group"></div>
              <div className="button-group">
                <Button type="submit">Submit Form</Button>
                <Button type="reset">Reset</Button>
              </div>
            </Form>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("‚úÖ") ? "result-success" : result.startsWith("‚ùå") ? "result-error" : ""}`}
            >
              {result || "Fill form and submit..."}
            </div>
          </div>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const FormInputErrorDemo = () => {
        const [result, setResult] = useState("");
        const [isLoading, setIsLoading] = useState(false);

        const formErrorAction = async ({ username, email }) => {
          setIsLoading(true);
          setResult("Submitting form...");
          try {
            await delay(1000);
            // Simulate server-side validation errors
            if (!username || username.length < 3) {
              throw new Error("Username must be at least 3 characters long");
            }
            if (username === "admin") {
              throw new Error(
                "Username 'admin' is reserved and cannot be used",
              );
            }
            // This will never be reached due to the conditions above
            const response = `‚úÖ Form submitted!\nUsername: ${username}\nEmail: ${email}`;
            setResult(response);
            return response;
          } catch (error) {
            setResult(`‚ùå Form error: ${error.message}`);
            throw error;
          } finally {
            setIsLoading(false);
          }
        };

        return (
          <div className="demo-card">
            <h3 className="demo-title">Form with Validation Errors</h3>
            <p
              style={{ fontSize: "14px", color: "#666", marginBottom: "15px" }}
            >
              This form demonstrates server-side validation errors. Try: empty
              fields, username &lt; 3 chars, invalid email, or "admin" username.
            </p>
            <Form action={formErrorAction}>
              <div className="control-group">
                <label>
                  Username:
                  <Input
                    name="username"
                    placeholder="Enter username (try 'admin' or < 3 chars)"
                  />
                </label>
              </div>
              <div className="button-group">
                <Button type="submit">Submit Form</Button>
                <Button type="reset">Reset</Button>
              </div>
            </Form>
            <div
              className={`result-display ${isLoading ? "result-loading" : result.startsWith("‚úÖ") ? "result-success" : result.startsWith("‚ùå") ? "result-error" : ""}`}
            >
              {result || "Fill form and submit to see validation errors..."}
            </div>
          </div>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
