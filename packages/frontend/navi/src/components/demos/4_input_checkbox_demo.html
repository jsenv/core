<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPA Input checkbox loading demo</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import {
        createAction,
        // eslint-disable-next-line no-unused-vars
        Form,
        // eslint-disable-next-line no-unused-vars
        Input,
      } from "@jsenv/navi";

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <div>
            <div style="display: flex; flex-direction: row; gap: 30px">
              <div>
                <p>
                  <strong>Loading</strong>
                </p>
                <Input
                  type="checkbox"
                  name="loading"
                  action={async () => {
                    await new Promise(() => {});
                  }}
                  style="color: blue"
                >
                  Test
                </Input>
              </div>
              <div>
                <p>
                  <strong>Throw after 1s</strong>
                </p>
                <Input
                  type="checkbox"
                  name="test"
                  action={async ({ test }) => {
                    await new Promise((resolve) => {
                      setTimeout(resolve, 1000);
                    });
                    throw new Error(`This is an error, checked: ${test}`);
                  }}
                  value="coucou"
                  style="color: blue"
                  // data-validation-message-stay-on-focus
                  // data-validation-message-stay-on-blur
                >
                  Test
                </Input>
              </div>
              <div>
                <p>
                  <strong>2 checkboxes for the same action</strong>
                </p>
                <Input
                  type="checkbox"
                  name="update"
                  action={updateUserCheckboxAction}
                  style="color: blue"
                >
                  Test
                </Input>
                <Input
                  type="checkbox"
                  name="update"
                  action={updateUserCheckboxAction}
                  style="color: blue"
                >
                  Test
                </Input>
              </div>
            </div>
            <div style="display: flex; flex-direction: row; gap: 30px">
              <div>
                <p>
                  <strong>Inside form</strong>
                </p>
                <Form
                  action={async ({ name, insideForm }) => {
                    await new Promise((resolve) => {
                      setTimeout(resolve, 600);
                    });
                    // eslint-disable-next-line no-alert
                    window.alert(
                      `params: { name: ${name}, insideForm: ${insideForm} }`,
                    );
                  }}
                >
                  <input type="hidden" name="name" value="dam" />
                  <Input type="checkbox" name="insideForm" style="color: blue">
                    Test
                  </Input>
                  <button type="submit">Submit</button>
                </Form>
              </div>

              <div>
                <p>
                  <strong>Inside form + checked at start</strong>
                </p>
                <Form
                  action={async ({ name, insideForm }) => {
                    await new Promise((resolve) => {
                      setTimeout(resolve, 600);
                    });
                    // eslint-disable-next-line no-alert
                    window.alert(
                      `params: { name: ${name}, insideForm: ${insideForm} }`,
                    );
                  }}
                >
                  <input type="hidden" name="name" value="dam" />
                  <Input
                    type="checkbox"
                    name="insideForm"
                    style="color: blue"
                    checked
                  >
                    Test
                  </Input>
                  <button type="submit">Submit</button>
                </Form>
              </div>
            </div>

            <div style="display: flex; flex-direction: row; gap: 30px">
              <div>
                <p>
                  <strong>
                    3 checkbox throwing after 1.5s (click quickly to display
                    many messages)
                  </strong>
                </p>
                <Input
                  type="checkbox"
                  name="a"
                  style="color: blue"
                  action={async () => {
                    await new Promise((resolve) => setTimeout(resolve, 1_500));
                    throw new Error(`error checking a`);
                  }}
                >
                  A
                </Input>
                <br />
                <Input
                  type="checkbox"
                  name="b"
                  style="color: green"
                  action={async () => {
                    await new Promise((resolve) => setTimeout(resolve, 1_500));
                    throw new Error(`error checking b`);
                  }}
                >
                  B
                </Input>
                <br />
                <Input
                  type="checkbox"
                  name="c"
                  style="color: yellow"
                  action={async () => {
                    await new Promise((resolve) => setTimeout(resolve, 1_500));
                    throw new Error(`error checking c`);
                  }}
                >
                  C
                </Input>
              </div>
            </div>
          </div>
        );
      };

      const updateUserCheckboxAction = createAction(async () => {
        await new Promise((resolve) => {
          setTimeout(resolve, 2000);
        });
      });

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
