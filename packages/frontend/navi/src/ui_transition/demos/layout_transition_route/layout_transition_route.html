<!doctype html>
<html>
  <head>
    <title>UITransition Size Demo with Routes</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
      }

      #root {
        width: 100%;
        height: 100%;
      }

      body {
        position: relative;
        margin: 0;
        padding: 0;
        font-family: system-ui;
        background:
          repeating-linear-gradient(
            45deg,
            transparent,
            transparent 100px,
            rgba(0, 0, 0, 0.05) 100px,
            rgba(0, 0, 0, 0.05) 200px
          ),
          linear-gradient(
            45deg,
            rgba(255, 255, 0, 0.8) 0%,
            rgba(255, 255, 0, 0.6) 100%
          );
      }

      body::before {
        position: fixed;
        top: 50%;
        left: 50%;
        z-index: -1;
        color: rgba(0, 0, 0, 0.1);
        font-weight: 900;
        font-size: 8rem;
        letter-spacing: 2rem;
        transform: translate(-50%, -50%) rotate(-45deg);
        pointer-events: none;
        content: "BODY";
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { useRef, useState } from "preact/hooks";
      import {
        Link,
        Routes,
        Route,
        Box,
        RouteLink,
        setupRoutes,
        UITransition,
        DialogLayout,
        ViewportLayout,
      } from "@jsenv/navi";

      const {
        DIALOG_ROUTE,
        DIALOG2_ROUTE,
        DIALOG3_ROUTE,
        VIEWPORT_ROUTE,
        VIEWPORT_OVERFLOW_X_ROUTE,
        VIEWPORT_OVERFLOW_Y_ROUTE,
        VIEWPORT_OVERFLOW_XY_ROUTE,
      } = setupRoutes({
        DIALOG_ROUTE: "",
        DIALOG2_ROUTE: "dialog2",
        DIALOG3_ROUTE: "dialog3",
        VIEWPORT_ROUTE: "viewport",
        VIEWPORT_OVERFLOW_X_ROUTE: "viewport_overflow_x",
        VIEWPORT_OVERFLOW_Y_ROUTE: "viewport_overflow_y",
        VIEWPORT_OVERFLOW_XY_ROUTE: "viewport_overflow_xy",
      });

      const Router = ({ uiTransitionRef }) => {
        return (
          <Routes element={<RootLayout uiTransitionRef={uiTransitionRef} />}>
            <Route element={<ViewportPage />} route={VIEWPORT_ROUTE} />
            <Route
              element={<ViewportOverflowXPage />}
              route={VIEWPORT_OVERFLOW_X_ROUTE}
            />
            <Route
              element={<ViewportOverflowYPage />}
              route={VIEWPORT_OVERFLOW_Y_ROUTE}
            />
            <Route
              element={<ViewportOverflowXYPage />}
              route={VIEWPORT_OVERFLOW_XY_ROUTE}
            />
            <Route
              meta={{ layout: "dialog" }}
              element={<BigPage />}
              route={DIALOG2_ROUTE}
            />
            <Route
              meta={{ layout: "dialog" }}
              element={<MediumPage />}
              route={DIALOG3_ROUTE}
            />
            <Route
              meta={{ layout: "dialog" }}
              element={<SmallPage />}
              fallback
            />
          </Routes>
        );
      };

      const Nav = ({ uiTransitionRef, globalCount, setGlobalCount }) => {
        return (
          <Box
            as="nav"
            row
            spacing="16"
            style="position: fixed; z-index: 1; top: 0; left: 0;"
          >
            <RouteLink route={DIALOG_ROUTE}>Dialog</RouteLink>
            <RouteLink route={DIALOG2_ROUTE}>Dialog 2</RouteLink>
            <RouteLink route={DIALOG3_ROUTE}>Dialog 3</RouteLink>
            <RouteLink route={VIEWPORT_ROUTE}>Viewport</RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_X_ROUTE}>
              Viewport x overflow
            </RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_Y_ROUTE}>
              Viewport y overflow
            </RouteLink>
            <RouteLink route={VIEWPORT_OVERFLOW_XY_ROUTE}>
              Viewport overflow xy
            </RouteLink>

            <div style="background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px; margin-left: 16px;">
              <div style="display: flex; align-items: center; gap: 8px; color: #333;">
                <span>Global: {globalCount}</span>
                <button
                  style="padding: 4px 8px; border: 1px solid #ccc; background: #f5f5f5; border-radius: 3px; cursor: pointer;"
                  onClick={() => setGlobalCount(globalCount + 1)}
                >
                  +1
                </button>
              </div>
            </div>

            <PauseControls uiTransitionRef={uiTransitionRef} />
          </Box>
        );
      };

      const PauseControls = ({ uiTransitionRef }) => {
        return (
          <div style="background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px;">
            <label style="display: flex; align-items: center; gap: 8px; color: #333;">
              <input
                type="checkbox"
                id="pauseCheckbox"
                onChange={(e) => {
                  if (uiTransitionRef.current) {
                    if (e.target.checked) {
                      const pausePercentage =
                        document.querySelector("#pausePercentage").value;
                      const ratio = pausePercentage / 100;
                      uiTransitionRef.current.setPauseBreakpoints([ratio]);
                    } else {
                      uiTransitionRef.current.setPauseBreakpoints([]);
                    }
                  }
                }}
              />
              Pause at
              <input
                type="range"
                id="pausePercentage"
                min="1"
                max="99"
                value="80"
                style="width: 60px;"
                onInput={(e) => {
                  document.querySelector("#pauseLabel").textContent =
                    `${e.target.value}%`;
                }}
              />
              <span id="pauseLabel">80%</span>
            </label>
            <button
              id="resumeButton"
              style="margin-left: 8px; padding: 4px 8px; border: 1px solid #ccc; background: #f5f5f5; border-radius: 3px; cursor: pointer;"
              onClick={() => {
                if (window.resumeTransitions) {
                  window.resumeTransitions();
                }
              }}
            >
              Resume Transitions
            </button>
          </div>
        );
      };

      const RootLayout = ({ uiTransitionRef }) => {
        return (
          <UITransition
            uiTransitionRef={uiTransitionRef}
            duration="2000"
            debugDetection
            debugSize
            debugContent
          >
            <Route.Slot />
          </UITransition>
        );
      };

      const SmallPage = () => {
        const [count, setCount] = useState(0);

        return (
          <DialogLayout>
            <div>
              <div>300x250 with border</div>
              <div style="margin: 20px 0;">
                <div style="margin-bottom: 10px;">Counter: {count}</div>
                <button
                  style="padding: 8px 16px; border: 1px solid #ccc; background: #f5f5f5; border-radius: 4px; cursor: pointer;"
                  onClick={() => setCount(count + 1)}
                >
                  Increment ({count})
                </button>
              </div>
            </div>
          </DialogLayout>
        );
      };

      const BigPage = () => {
        const [count, setCount] = useState(0);

        return (
          <DialogLayout>
            <div style="width: 500px; height: 400px; padding: 20px;">
              <div style="font-size: 18px; margin-bottom: 20px;">
                500x400 Big Dialog
              </div>
              <div style="margin: 20px 0;">
                <div style="margin-bottom: 10px;">
                  Big Dialog Counter: {count}
                </div>
                <button
                  style="padding: 12px 20px; border: 1px solid #007acc; background: #e6f3ff; border-radius: 6px; cursor: pointer; font-size: 16px;"
                  onClick={() => setCount(count + 1)}
                >
                  Big Increment ({count})
                </button>
              </div>
              <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin-top: 20px;">
                <p>
                  This is a larger dialog to test size transitions between
                  different dialog layouts.
                </p>
                <p>
                  You can navigate between Dialog and Dialog 2 to see the smooth
                  size animation.
                </p>
              </div>
            </div>
          </DialogLayout>
        );
      };

      const MediumPage = () => {
        const [count, setCount] = useState(0);

        return (
          <DialogLayout>
            <div style="width: 480px; height: 420px; padding: 20px;">
              <div style="font-size: 18px; margin-bottom: 20px; color: #d4691b;">
                480x420 Medium Dialog
              </div>
              <div style="margin: 20px 0;">
                <div style="margin-bottom: 10px;">
                  Medium Dialog Counter: {count}
                </div>
                <button
                  style="padding: 12px 20px; border: 1px solid #d4691b; background: #fff5ee; border-radius: 6px; cursor: pointer; font-size: 16px;"
                  onClick={() => setCount(count + 1)}
                >
                  Medium Increment ({count})
                </button>
              </div>
              <div style="background: #fff5ee; padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid #ffdab3;">
                <p>
                  This dialog is slightly smaller than Dialog 2 (480x420 vs
                  500x400) to test subtle size transitions.
                </p>
                <p style="margin: 0;">
                  Navigate between Dialog 2 and Dialog 3 to see the minimal size
                  difference animation.
                </p>
              </div>
            </div>
          </DialogLayout>
        );
      };

      const ViewportPage = () => {
        return <ViewportLayout>Full page no border</ViewportLayout>;
      };
      const ViewportOverflowXPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_wide_page"
            minWidth="150vw"
            color="blue"
            size="lg"
            bold
          >
            Wide Page (150% viewport width)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );
      const ViewportOverflowYPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_tall_page"
            minHeight="150vh"
            padding="40"
            color="green"
            size="lg"
            bold
          >
            Tall Page (150% viewport height)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );
      const ViewportOverflowXYPage = () => (
        <ViewportLayout>
          <Box
            id="viewport_tall_page"
            minWidth="150vw"
            minHeight="150vh"
            padding="40"
            color="green"
            size="lg"
            bold
          >
            Wide and tall Page (150% viewport width/height)
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
            <div>Extra content to make sure scrolling is possible</div>
          </Box>
        </ViewportLayout>
      );

      const App = () => {
        const uiTransitionRef = useRef();
        const [globalCount, setGlobalCount] = useState(0);

        return (
          <>
            <Nav
              uiTransitionRef={uiTransitionRef}
              globalCount={globalCount}
              setGlobalCount={setGlobalCount}
            />
            <Router uiTransitionRef={uiTransitionRef} />
          </>
        );
      };

      render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
