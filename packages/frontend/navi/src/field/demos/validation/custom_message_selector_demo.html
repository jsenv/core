<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Custom Message Attribute Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:," />
    <style>
      body {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        font-family: Arial, sans-serif;
        line-height: 1.6;
      }

      .demo-section {
        margin: 40px 0;
        padding: 20px;
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
      }

      .demo-section h2 {
        margin-top: 0;
        color: #333;
      }

      .form-container {
        margin: 20px 0;
        padding: 15px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      input[type="text"] {
        width: 200px;
        margin: 10px 0;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      button {
        margin: 10px 5px 10px 0;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .submit-btn {
        color: white;
        background: #007cba;
      }

      .modify-btn {
        color: white;
        background: #28a745;
      }

      .template-container {
        margin: 15px 0;
        padding: 15px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
      }

      .template-note {
        margin-bottom: 10px;
        color: #856404;
        font-style: italic;
        font-size: 14px;
      }

      .message-template {
        padding: 12px;
        color: #721c24;
        font-weight: bold;
        background: #f8d7da;
        border: 2px solid #dc3545;
        border-radius: 6px;
      }

      .dynamic-template {
        padding: 12px;
        color: #856404;
        font-weight: bold;
        background: #fff3cd;
        border: 2px solid #fd7e14;
        border-radius: 6px;
      }

      .counter {
        margin-left: 8px;
        padding: 2px 6px;
        color: white;
        font-size: 12px;
        background: #6c757d;
        border-radius: 3px;
      }

      textarea {
        width: 100%;
        height: 80px;
        padding: 8px;
        font-family: Arial, sans-serif;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical;
      }
    </style>
  </head>
  <body>
    <h1>Custom Message Attribute Demo</h1>
    <p>
      This demo shows how <code>data-x-message</code> attributes can use CSS
      selectors to reference DOM elements for advanced custom validation
      messages.
    </p>

    <!-- Scenario 1: String Message -->
    <div class="demo-section">
      <h2>Scenario 1: Simple String Message</h2>
      <p>
        Traditional approach with a plain text message in the
        <code>data-required-message</code> attribute.
      </p>

      <div class="form-container">
        <form id="form1">
          <label>
            Name (required):
            <input
              type="text"
              name="name"
              required
              data-required-message="Please enter your name - this is a simple string message"
            />
          </label>
          <br />
          <button type="submit" class="submit-btn">Submit</button>
        </form>
      </div>
    </div>

    <!-- Scenario 2: CSS Selector Message -->
    <div class="demo-section">
      <h2>Scenario 2: CSS Selector Message</h2>
      <p>
        Advanced approach using a CSS ID selector
        (<code>#custom-required-template</code>) in the
        <code>data-required-message</code> attribute.
      </p>

      <div class="template-container">
        <div class="template-note">
          üìù <strong>Message Template</strong> (in real world, this would be
          hidden with CSS):
        </div>
        <div id="custom-required-template" class="message-template">
          <strong>üö´ Custom Required Error</strong>
          <p>This field is mandatory and cannot be left empty!</p>
          <small
            >This message comes from a DOM template with ID
            #custom-required-template</small
          >
        </div>
      </div>

      <div class="form-container">
        <form id="form2">
          <label>
            Email (required):
            <input
              type="text"
              name="email"
              required
              data-required-message="#custom-required-template"
            />
          </label>
          <br />
          <button type="submit" class="submit-btn">Submit</button>
        </form>
      </div>
    </div>

    <!-- Scenario 3: Dynamic CSS Selector Message -->
    <div class="demo-section">
      <h2>Scenario 3: Live Dynamic Message Template</h2>
      <p>
        Same as scenario 2, but with live template modification to show how the
        validation message adapts in real-time.
      </p>

      <div class="template-container">
        <div class="template-note">
          üìù <strong>Dynamic Message Template</strong> (modify it to see live
          updates):
        </div>
        <div id="dynamic-required-template" class="dynamic-template">
          <strong>‚ö° Dynamic Required Error</strong>
          <p>Updates: <span class="counter" id="update-counter">0</span></p>
          <small>Template ID: #dynamic-required-template</small>
        </div>

        <div style="margin-top: 15px">
          <button type="button" class="modify-btn" onclick="incrementCounter()">
            Increment Counter
          </button>
          <select
            id="color-select"
            onchange="changeColor()"
            style="margin: 0 5px; padding: 5px"
          >
            <option value="#fff3cd">Warning Yellow</option>
            <option value="#d4edda">Success Green</option>
            <option value="#cce7ff">Info Blue</option>
          </select>
          <button type="button" class="modify-btn" onclick="resetTemplate()">
            Reset
          </button>
        </div>
      </div>

      <div class="form-container">
        <form id="form3">
          <label>
            Username (required):
            <input
              type="text"
              name="username"
              required
              data-required-message="#dynamic-required-template"
            />
          </label>
          <br />
          <button type="submit" class="submit-btn">Submit</button>
        </form>
      </div>
    </div>

    <script type="module">
      import {
        installCustomConstraintValidation,
        requestAction,
      } from "@jsenv/navi";

      // Initialize custom validation on all forms and their elements
      const forms = document.querySelectorAll("form");
      forms.forEach((form) => {
        installCustomConstraintValidation(form);

        // Listen for actionrequested event to call requestAction
        form.addEventListener("actionrequested", (event) => {
          requestAction(form, () => {}, { event });
        });

        // Install on all form elements
        const elements = form.querySelectorAll(
          "input, button, select, textarea",
        );
        elements.forEach((element) => {
          installCustomConstraintValidation(element);
        });
      });

      // Global functions for template modification
      let updateCount = 0;

      window.incrementCounter = () => {
        const counter = document.getElementById("update-counter");
        if (counter) {
          updateCount++;
          counter.textContent = updateCount;
        }
      };

      window.changeColor = () => {
        const template = document.getElementById("dynamic-required-template");
        const select = document.getElementById("color-select");
        template.style.backgroundColor = select.value;
      };

      window.resetTemplate = () => {
        const template = document.getElementById("dynamic-required-template");
        const counter = document.getElementById("update-counter");
        const select = document.getElementById("color-select");

        updateCount = 0;

        if (counter) {
          counter.textContent = updateCount;
        }
        template.style.backgroundColor = "#fff3cd"; // Original color
        select.value = "#fff3cd"; // Reset select to original
      };

      // Add some helpful logging
      document.addEventListener("DOMContentLoaded", () => {
        console.log(
          "Demo loaded! Try submitting empty forms to see validation messages.",
        );
        console.log("- Scenario 1: Uses plain string message");
        console.log(
          "- Scenario 2: Uses CSS selector #custom-required-template",
        );
        console.log(
          "- Scenario 3: Uses CSS selector #dynamic-required-template with live updates",
        );
      });
    </script>
  </body>
</html>
