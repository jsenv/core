<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overlay Demo</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        min-height: 300vh; /* Make page tall enough to scroll */
      }

      .demo-header {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .demo-title {
        margin: 0 0 10px 0;
        font-size: 24px;
        color: #333;
      }

      .demo-description {
        margin: 0;
        color: #666;
        line-height: 1.5;
      }

      .target-element {
        width: 300px;
        height: 200px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: 3px solid #333;
        border-radius: 12px;
        margin: 100px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 18px;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .overlay-ui {
        position: fixed;
        z-index: 1000;
        overflow: hidden;
        inset: 0;
        pointer-events: none;
        background: rgba(0, 255, 0, 0.1);
      }

      .overlay-container {
        position: absolute;
        background: rgba(255, 0, 0, 0.5);
        border: 2px dashed white;
        pointer-events: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
      }

      .content-section {
        background: white;
        margin: 40px 0;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .content-section:nth-child(even) {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        color: #1976d2;
      }

      .content-section:nth-child(odd) {
        background: linear-gradient(135deg, #f3e5f5, #ce93d8);
        color: #7b1fa2;
      }

      .scroll-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        z-index: 2000;
      }

      .controls {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-width: 400px;
      }

      .controls h3 {
        margin: 0 0 15px 0;
        font-size: 16px;
        color: #333;
      }

      .controls button {
        padding: 10px 15px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        margin-right: 10px;
      }

      .controls button:hover {
        background: #45a049;
      }

      .controls button.active {
        background: #2196f3;
      }
    </style>
  </head>
  <body>
    <div class="demo-header">
      <h1 class="demo-title">Overlay Demo</h1>
      <p class="demo-description">
        This demo shows how the overlay system positions an element on top of
        another element.
        <br /><strong>Instructions:</strong> Scroll the page and watch how the
        red overlay follows the blue target element, only showing the visible
        portion.
      </p>
    </div>

    <div class="controls">
      <h3>Scrollable Container</h3>
      <button id="documentBtn" class="active">Document</button>
      <button id="customBtn">Custom Container</button>
    </div>

    <div class="scroll-indicator" id="scrollIndicator">Scroll: 0px</div>

    <!-- Target element that will be overlaid -->
    <div class="target-element" id="targetElement">Target Element</div>

    <!-- Overlay UI (initially hidden) -->
    <div class="overlay-ui" id="overlayUI" style="display: none">
      <div class="overlay-container" id="overlayContainer">OVERLAY</div>
    </div>

    <div class="content-section">
      <h2>Section 1</h2>
      <p>
        Scroll down to see how the overlay follows the target element. The
        overlay only covers the visible portion of the target.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 2</h2>
      <p>
        Continue scrolling. When the target element is partially visible, the
        overlay will adjust its size accordingly.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 3</h2>
      <p>
        When you scroll past the target element completely, the overlay will
        disappear as the target is no longer visible.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 4</h2>
      <p>
        Scroll back up to see the overlay reappear when the target becomes
        visible again.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 5</h2>
      <p>
        The overlay system handles all the complex positioning logic
        automatically, including different scrollable containers.
      </p>
    </div>

    <script type="module">
      import { initOverlay } from "../position/overlay.js";

      const targetElement = document.getElementById("targetElement");
      const overlayUI = document.getElementById("overlayUI");
      const overlayContainer = document.getElementById("overlayContainer");
      const scrollIndicator = document.getElementById("scrollIndicator");
      const documentBtn = document.getElementById("documentBtn");
      const customBtn = document.getElementById("customBtn");

      let currentOverlay = null;

      // Update scroll indicator
      const updateScrollIndicator = () => {
        const scrollY = window.scrollY || document.documentElement.scrollTop;
        scrollIndicator.textContent = `Scroll: ${Math.round(scrollY)}px`;
      };

      // Initialize scroll indicator
      updateScrollIndicator();
      window.addEventListener("scroll", updateScrollIndicator);

      // Initialize overlay with document scrolling
      function initDocumentOverlay() {
        if (currentOverlay) {
          currentOverlay.destroy();
        }

        overlayUI.style.display = "block";

        currentOverlay = initOverlay(targetElement, (visibleRect, fullRect) => {
          // Update overlay container position and size
          overlayContainer.style.left = `${visibleRect.left}px`;
          overlayContainer.style.top = `${visibleRect.top}px`;
          overlayContainer.style.width = `${visibleRect.width}px`;
          overlayContainer.style.height = `${visibleRect.height}px`;

          // Hide overlay if element is not visible
          if (visibleRect.width <= 0 || visibleRect.height <= 0) {
            overlayContainer.style.display = "none";
          } else {
            overlayContainer.style.display = "flex";
          }

          console.log("Overlay updated:", { visibleRect, fullRect });
        });

        console.log("Document overlay initialized");
      }

      // Initialize overlay with custom container (for future expansion)
      function initCustomOverlay() {
        // For now, just use document overlay
        // This could be expanded to demonstrate custom scrollable containers
        initDocumentOverlay();
        console.log("Custom overlay initialized (using document for now)");
      }

      // Button handlers
      documentBtn.addEventListener("click", () => {
        documentBtn.classList.add("active");
        customBtn.classList.remove("active");
        initDocumentOverlay();
      });

      customBtn.addEventListener("click", () => {
        customBtn.classList.add("active");
        documentBtn.classList.remove("active");
        initCustomOverlay();
      });

      // Initialize with document overlay
      initDocumentOverlay();

      console.log("Overlay demo initialized");
    </script>
  </body>
</html>
