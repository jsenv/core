<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document Auto-Scroll Demo</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        min-height: 300vh; /* Make page tall enough to scroll */
        min-width: 200vw;
      }

      .demo-header {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .demo-title {
        margin: 0 0 10px 0;
        font-size: 24px;
        color: #333;
      }

      .demo-description {
        margin: 0;
        color: #666;
        line-height: 1.5;
      }

      .draggable-element {
        width: 120px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: 3px solid #333;
        border-radius: 12px;
        cursor: grab;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: box-shadow 0.2s ease;
        z-index: 1000;
        user-select: none;
      }

      .draggable-element:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      }

      .draggable-element[data-dragging] {
        cursor: grabbing;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      }

      .content-section {
        background: white;
        margin: 40px 0;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .content-section:nth-child(even) {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        color: #1976d2;
      }

      .content-section:nth-child(odd) {
        background: linear-gradient(135deg, #f3e5f5, #ce93d8);
        color: #7b1fa2;
      }

      .scroll-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        z-index: 2000;
      }
    </style>
  </head>
  <body>
    <div class="demo-header">
      <h1 class="demo-title">Document Auto-Scroll Demo</h1>
      <p class="demo-description">
        This demo tests document auto-scrolling behavior when dragging an
        element.
        <br /><strong>Instructions:</strong> Drag the purple element near the
        top or bottom edges of the viewport to trigger auto-scrolling. <br />The
        document itself is the scrollable parent, so scrolling should work
        throughout the entire page.
      </p>
    </div>

    <div style="position: relative; inset: 0; left: 200px; top: 50px">
      <div
        class="draggable-element"
        id="dragElement"
        style="position: absolute"
      >
        Drag Me
      </div>
    </div>

    <!-- Programmatic Controls -->
    <div
      style="
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-width: 300px;
      "
    >
      <h3 style="margin: 0 0 15px 0; font-size: 16px; color: #333">
        Programmatic Controls
      </h3>
      <div style="display: flex; flex-direction: column; gap: 8px">
        <button
          id="grabBtn"
          style="
            padding: 10px 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
          "
        >
          Grab Element
        </button>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px">
          <button
            id="dragLeftBtn"
            disabled
            style="
              padding: 8px 12px;
              background: #9c27b0;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 12px;
              opacity: 0.5;
            "
          >
            ← Left
          </button>
          <button
            id="dragRightBtn"
            disabled
            style="
              padding: 8px 12px;
              background: #2196f3;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 12px;
              opacity: 0.5;
            "
          >
            Right →
          </button>
          <button
            id="dragUpBtn"
            disabled
            style="
              padding: 8px 12px;
              background: #607d8b;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 12px;
              opacity: 0.5;
            "
          >
            ↑ Up
          </button>
          <button
            id="dragDownBtn"
            disabled
            style="
              padding: 8px 12px;
              background: #ff9800;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 12px;
              opacity: 0.5;
            "
          >
            ↓ Down
          </button>
        </div>
        <button
          id="releaseBtn"
          disabled
          style="
            padding: 10px 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            opacity: 0.5;
          "
        >
          Release Element
        </button>
      </div>
      <div
        id="status"
        style="
          margin-top: 15px;
          padding: 10px;
          background: #f9f9f9;
          border-radius: 4px;
          font-family: monospace;
          font-size: 12px;
          color: #666;
          border-left: 4px solid #2196f3;
        "
      >
        Ready - Click "Grab Element" to start programmatic control
      </div>
    </div>

    <div
      data-drag-obstacle
      style="
        position: absolute;
        left: 100px;
        top: 450px;
        background: red;
        width: 50px;
        height: 50px;
      "
    >
      absolute
    </div>

    <div
      data-drag-obstacle
      style="
        position: fixed;
        left: 280px;
        top: 100px;
        background: violet;
        width: 50px;
        height: 50px;
      "
    >
      fixed
    </div>

    <div
      data-drag-obstacle
      style="
        position: sticky;
        left: 280px;
        top: 300px;
        background: green;
        width: 50px;
        height: 50px;
      "
    >
      sticky
    </div>

    <div class="scroll-indicator" id="scrollIndicator">Scroll: 0px</div>

    <div class="content-section">
      <h2>Section 1</h2>
      <p>
        Drag the element above towards the top edge of your viewport to test
        upward auto-scrolling.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 2</h2>
      <p>
        This is some content to make the page scrollable. Keep dragging down to
        test auto-scroll behavior.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 3</h2>
      <p>
        More content for testing. Drag the element near the bottom edge to
        trigger downward scrolling.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 4</h2>
      <p>
        Continue testing the auto-scroll behavior as you drag near viewport
        edges.
      </p>
    </div>

    <div class="content-section">
      <h2>Section 5</h2>
      <p>
        Final section. The auto-scroll should work smoothly in both directions.
      </p>
    </div>

    <script type="module">
      import { createDragToMoveGestureController } from "../interaction/drag_to_move.js";

      const dragElement = document.getElementById("dragElement");
      const scrollIndicator = document.getElementById("scrollIndicator");

      // Update scroll indicator
      const updateScrollIndicator = () => {
        const scrollY = window.scrollY || document.documentElement.scrollTop;
        scrollIndicator.textContent = `Scroll: ${Math.round(scrollY)}px`;
      };

      // Initialize scroll indicator
      updateScrollIndicator();
      window.addEventListener("scroll", updateScrollIndicator);

      // Manual drag gesture (mouse-based)
      const manualDragGestureController = createDragToMoveGestureController({
        threshold: 0,
        areaConstraint: "scroll",
      });

      dragElement.onmousedown = (e) => {
        // Set up the manual drag behavior
        manualDragGestureController.grabViaMouse(e, {
          element: dragElement,
          onStart: () => {
            dragElement.setAttribute("data-dragging", "");
            updateStatus("Manual drag started - document auto-scroll enabled");
          },
          onEnd: () => {
            dragElement.removeAttribute("data-dragging");
            updateStatus("Manual drag ended");
          },
        });
      };

      // Programmatic Controls
      const controls = {
        grabBtn: document.getElementById("grabBtn"),
        dragLeftBtn: document.getElementById("dragLeftBtn"),
        dragRightBtn: document.getElementById("dragRightBtn"),
        dragUpBtn: document.getElementById("dragUpBtn"),
        dragDownBtn: document.getElementById("dragDownBtn"),
        releaseBtn: document.getElementById("releaseBtn"),
        statusDiv: document.getElementById("status"),
        dragGesture: null,
      };

      function updateStatus(message) {
        controls.statusDiv.textContent = message;
        console.log("Document Auto-Scroll Demo:", message);
      }

      function updateButtonStates(grabbed = false) {
        controls.grabBtn.disabled = grabbed;
        controls.dragLeftBtn.disabled = !grabbed;
        controls.dragRightBtn.disabled = !grabbed;
        controls.dragUpBtn.disabled = !grabbed;
        controls.dragDownBtn.disabled = !grabbed;
        controls.releaseBtn.disabled = !grabbed;

        // Update visual disabled state
        const dragButtons = [
          controls.dragLeftBtn,
          controls.dragRightBtn,
          controls.dragUpBtn,
          controls.dragDownBtn,
          controls.releaseBtn,
        ];
        dragButtons.forEach((btn) => {
          btn.style.opacity = grabbed ? "1" : "0.5";
          btn.style.cursor = grabbed ? "pointer" : "not-allowed";
        });

        controls.grabBtn.style.opacity = grabbed ? "0.5" : "1";
        controls.grabBtn.style.cursor = grabbed ? "not-allowed" : "pointer";
      }

      // Grab button
      controls.grabBtn.addEventListener("click", () => {
        if (controls.dragGesture) return;

        const dragOptions = {
          threshold: 0,
          onGrab: (gestureInfo) => {
            updateStatus("Element grabbed programmatically - ready to drag");
            console.log("Programmatic grab:", gestureInfo);
          },
          onDragStart: (gestureInfo) => {
            updateStatus("Programmatic drag started with document auto-scroll");
            dragElement.setAttribute("data-dragging", "");
            console.log("Programmatic drag start:", gestureInfo);
          },
          onDrag: (gestureInfo, phase) => {
            updateStatus(
              `Dragging programmatically (${phase}) - auto-scroll active`,
            );
            console.log("Programmatic drag:", gestureInfo, phase);
          },
          onRelease: (gestureInfo) => {
            updateStatus("Programmatic drag released");
            dragElement.removeAttribute("data-dragging");
            console.log("Programmatic release:", gestureInfo);
            controls.dragGestureController = null;
            controls.dragInstance = null;
            updateButtonStates(false);
          },
        };

        controls.dragGestureController =
          createDragToMoveGestureController(dragOptions);
        controls.dragGesture = controls.dragGestureController.grab({
          dragElement,
        });

        updateButtonStates(true);
      });

      // Drag direction buttons
      controls.dragLeftBtn.addEventListener("click", () => {
        if (!controls.dragGesture) return;
        const currentGestureInfo = controls.dragGesture.gestureInfo;
        const newX = currentGestureInfo.xMove - 100;
        updateStatus("Dragging left by 100px - testing document auto-scroll");
        controls.dragGesture.drag(newX, currentGestureInfo.y);
      });

      controls.dragRightBtn.addEventListener("click", () => {
        if (!controls.dragGesture) return;
        const currentGestureInfo = controls.dragGesture.gestureInfo;
        const newX = currentGestureInfo.xMove + 100;
        updateStatus("Dragging right by 100px - testing document auto-scroll");
        controls.dragGesture.drag(newX, currentGestureInfo.y);
      });

      controls.dragUpBtn.addEventListener("click", () => {
        if (!controls.dragGesture) return;
        const currentGestureInfo = controls.dragGesture.gestureInfo;
        const newY = currentGestureInfo.yMove - 100;
        updateStatus("Dragging up by 100px - testing upward auto-scroll");
        controls.dragGesture.drag(currentGestureInfo.x, newY);
      });

      controls.dragDownBtn.addEventListener("click", () => {
        if (!controls.dragGesture) return;
        const currentGestureInfo = controls.dragGesture.gestureInfo;
        const newY = currentGestureInfo.yMove + 100;
        updateStatus("Dragging down by 100px - testing downward auto-scroll");
        controls.dragGesture.drag(currentGestureInfo.x, newY);
      });

      // Release button
      controls.releaseBtn.addEventListener("click", () => {
        if (!controls.dragGesture) return;
        updateStatus("Releasing programmatic drag");
        controls.dragGesture.release();
      });

      // Initialize
      updateButtonStates(false);
      console.log(
        "Document auto-scroll demo with programmatic controls initialized",
      );
    </script>
  </body>
</html>
