<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drag Gesture Demo - Multiple Cases</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
      }

      .demo-section {
        margin: 40px auto;
        max-width: 800px;
      }

      .demo-title {
        background: white;
        padding: 15px 20px;
        border-radius: 8px 8px 0 0;
        border-bottom: 2px solid #333;
        margin: 0;
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .container {
        width: 400px;
        height: 200px;
        border: 2px solid #333;
        border-top: none;
        background: white;
        overflow: auto;
        position: relative;
        margin: 0 auto;
        border-radius: 0 0 8px 8px;
      }

      /* Horizontal only scroll */
      .horizontal-content {
        width: 800px; /* Make content wider than container for horizontal scroll */
        height: 200px; /* Same height as container - no vertical scroll */
        background: linear-gradient(
          90deg,
          transparent 99px,
          #ddd 100px,
          #ddd 101px,
          transparent 102px
        );
        background-size: 100px 100px;
        position: relative;
      }

      /* Both horizontal and vertical scroll */
      .both-content {
        width: 800px; /* Make content wider than container for horizontal scroll */
        height: 400px; /* Make content taller than container for vertical scroll */
        background:
          linear-gradient(
            90deg,
            transparent 99px,
            #ddd 100px,
            #ddd 101px,
            transparent 102px
          ),
          linear-gradient(
            transparent 99px,
            #ddd 100px,
            #ddd 101px,
            transparent 102px
          );
        background-size: 100px 100px;
        position: relative;
      }

      .draggable-rectangle {
        width: 80px;
        height: 60px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: 2px solid #333;
        border-radius: 8px;
        position: absolute;
        top: 50px;
        left: 50px;
        cursor: grab;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: box-shadow 0.2s ease;
      }

      .draggable-rectangle:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }

      .draggable-rectangle[data-dragging] {
        cursor: grabbing;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        z-index: 1000;
      }

      .info {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .info h1 {
        margin-top: 0;
        color: #333;
      }

      .info ul {
        line-height: 1.6;
      }

      .debug-toggle {
        margin: 20px auto;
        text-align: center;
      }

      .debug-toggle label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #333;
        cursor: pointer;
        background: white;
        padding: 10px 15px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
      }

      .debug-toggle label:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .debug-toggle input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="info">
      <h1>Drag Gesture Demo - Multiple Cases</h1>
      <p>
        This demo showcases different drag gesture scenarios with auto-scroll:
      </p>
      <ul>
        <li>
          <strong>Drag the purple rectangles</strong> within their containers
        </li>
        <li>
          <strong>Auto-scroll triggers</strong> when you drag near the edges
        </li>
        <li>
          <strong>Visual debug markers</strong> show boundaries (toggle below)
        </li>
        <li>
          <strong>Compare behavior</strong> between horizontal-only and
          bi-directional scrolling
        </li>
      </ul>
    </div>

    <div class="debug-toggle">
      <label>
        <input type="checkbox" id="debugMarkersCheckbox" checked />
        Show Debug Markers
      </label>
    </div>

    <!-- Case 1: Horizontal Scroll Only -->
    <div class="demo-section">
      <h2 class="demo-title">Case 1: Horizontal Scroll Only</h2>
      <div class="container" id="horizontalContainer">
        <div class="horizontal-content">
          <div class="draggable-rectangle" id="horizontalRectangle">
            DRAG ME →
          </div>
        </div>
      </div>
    </div>

    <!-- Case 2: Both Horizontal and Vertical Scroll -->
    <div class="demo-section">
      <h2 class="demo-title">Case 2: Both Horizontal & Vertical Scroll</h2>
      <div class="container" id="bothContainer">
        <div class="both-content">
          <div class="draggable-rectangle" id="bothRectangle">DRAG ME ↗</div>
        </div>
      </div>
    </div>

    <script type="module">
      // Import the drag gesture functionality
      // Note: You'll need to adjust the import path based on your setup
      import {
        startDragGesture,
        DRAG_DEBUG_VISUAL_MARKERS,
        enableDebugMarkers,
        disableDebugMarkers,
      } from "../interaction/drag_gesture.js";
      import { getScrollableParent } from "../scroll.js";

      // Make functions available globally for the demo
      window.startDragGesture = startDragGesture;
      window.getScrollableParent = getScrollableParent;
      window.enableDebugMarkers = enableDebugMarkers;
      window.disableDebugMarkers = disableDebugMarkers;

      const horizontalRectangle = document.getElementById(
        "horizontalRectangle",
      );
      const bothRectangle = document.getElementById("bothRectangle");
      const debugCheckbox = document.getElementById("debugMarkersCheckbox");

      // Handle debug markers toggle
      debugCheckbox.checked = DRAG_DEBUG_VISUAL_MARKERS;
      debugCheckbox.addEventListener("change", (e) => {
        if (e.target.checked) {
          enableDebugMarkers();
        } else {
          disableDebugMarkers();
        }
      });

      // Function to set up drag gesture for any rectangle
      function setupDragGesture(rectangle, caseLabel) {
        rectangle.addEventListener("mousedown", (event) => {
          startDragGesture(event, {
            setup: () => ({
              element: rectangle,
              elementToMove: rectangle,
              elementVisuallyMoving: rectangle,
            }),
            onGrab: (gestureInfo) => {
              console.log(`${caseLabel} - Grab started`, gestureInfo);
            },
            onDragStart: (gestureInfo) => {
              console.log(`${caseLabel} - Drag started`, gestureInfo);
            },
            onDrag: () => {
              // console.log(`${caseLabel} - Dragging`, gestureInfo, phase);
            },
            onRelease: (gestureInfo) => {
              console.log(`${caseLabel} - Drag released`, gestureInfo);
            },
          });
        });
      }

      // Set up drag gestures for all rectangles
      setupDragGesture(horizontalRectangle, "Horizontal Only");
      setupDragGesture(bothRectangle, "Both Directions");
    </script>

    <script>
      // Add visual feedback for multiple containers
      document.addEventListener("DOMContentLoaded", () => {
        const horizontalContainer = document.getElementById(
          "horizontalContainer",
        );
        const bothContainer = document.getElementById("bothContainer");
        const horizontalRectangle = document.getElementById(
          "horizontalRectangle",
        );
        const bothRectangle = document.getElementById("bothRectangle");

        // Create info display for horizontal case
        const horizontalInfo = createInfoDisplay(
          "Horizontal Case",
          "10px",
          "10px",
        );
        const bothInfo = createInfoDisplay("Both Directions", "10px", "200px");

        function createInfoDisplay(label, top, right) {
          const info = document.createElement("div");
          info.style.position = "fixed";
          info.style.top = top;
          info.style.right = right;
          info.style.background = "rgba(0,0,0,0.8)";
          info.style.color = "white";
          info.style.padding = "8px 12px";
          info.style.borderRadius = "4px";
          info.style.fontSize = "11px";
          info.style.fontFamily = "monospace";
          info.style.zIndex = "10000";
          info.style.lineHeight = "1.4";
          info.style.minWidth = "160px";
          document.body.appendChild(info);
          return info;
        }

        function updateInfo(container, rectangle, infoDisplay, label) {
          const rect = rectangle.getBoundingClientRect();
          const containerRect = container.getBoundingClientRect();
          const relativeX =
            rect.left - containerRect.left + container.scrollLeft;
          const relativeY = rect.top - containerRect.top + container.scrollTop;

          infoDisplay.innerHTML = `
            <div style="font-weight: bold; margin-bottom: 4px;">${label}</div>
            <div>Scroll: ${Math.round(container.scrollLeft)}, ${Math.round(container.scrollTop)}</div>
            <div>Pos: ${Math.round(relativeX)}, ${Math.round(relativeY)}</div>
          `;
        }

        // Set up scroll listeners and initial updates
        function setupContainerMonitoring(
          container,
          rectangle,
          infoDisplay,
          label,
        ) {
          function update() {
            updateInfo(container, rectangle, infoDisplay, label);
          }

          container.addEventListener("scroll", update);
          update();

          // Update position info periodically while dragging
          let updateInterval;
          rectangle.addEventListener("mousedown", () => {
            updateInterval = setInterval(update, 16); // ~60fps
          });

          document.addEventListener("mouseup", () => {
            if (updateInterval) {
              clearInterval(updateInterval);
              update(); // Final update
            }
          });
        }

        setupContainerMonitoring(
          horizontalContainer,
          horizontalRectangle,
          horizontalInfo,
          "Horizontal Only",
        );
        setupContainerMonitoring(
          bothContainer,
          bothRectangle,
          bothInfo,
          "Both Directions",
        );
      });
    </script>
  </body>
</html>
