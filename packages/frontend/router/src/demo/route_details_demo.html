<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPA details demo</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import {
        registerRoute,
        // eslint-disable-next-line no-unused-vars
        Route,
      } from "@jsenv/router";

      const firstDetailsRoute = registerRoute({
        match: (state) => state.first_details_open === true,
        enter: (state) => {
          state.first_details_open = true;
        },
        leave: (state) => {
          state.first_details_open = false;
        },
        canDisplayOldData: true,
        load: async () => {
          await new Promise((resolve) => {
            setTimeout(resolve, 500);
          });
          return "Hello";
        },
        name: "loadingFor1sRoute",
      });

      const errorAfter500Route = registerRoute({
        match: (state) => state.error_after_500_open === true,
        enter: (state) => {
          state.error_after_500_open = true;
        },
        leave: (state) => {
          state.error_after_500_open = false;
        },
        canDisplayOldData: true,
        load: async () => {
          await new Promise((resolve) => {
            setTimeout(resolve, 500);
          });
          throw new Error("Error after 500ms");
        },
        name: "errorAfter500Route",
      });

      const errorWithHandlerRoute = registerRoute({
        match: (state) => state.error_with_handler_open === true,
        enter: (state) => {
          state.error_with_handler_open = true;
        },
        leave: (state) => {
          state.error_with_handler_open = false;
        },
        canDisplayOldData: true,
        load: async () => {
          await new Promise((resolve) => {
            setTimeout(resolve, 500);
          });
          throw new Error("Error after 500ms");
        },
        name: "errorWithHandlerRoute",
      });

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <div style="display: flex; flex-direction: row; gap: 30px">
            <div style="width: 200px;">
              <p>
                <strong>Loading for 1s</strong>
              </p>
              <Route.Details
                route={firstDetailsRoute}
                renderLoaded={({ data }) => <span>{data}</span>}
              >
                Text
              </Route.Details>
            </div>
            <div style="width: 200px;">
              <p>
                <strong>Error after 0.5s, no error handler</strong>
              </p>
              <Route.Details
                route={errorAfter500Route}
                renderLoaded={({ data }) => <span>{data}</span>}
              >
                Text
              </Route.Details>
            </div>
            <div style="width: 200px;">
              <p>
                <strong>Error after 0.5s, error handler</strong>
              </p>
              <Route.Details
                route={errorWithHandlerRoute}
                renderLoaded={({ data }) => <span>{data}</span>}
                renderError={({ error }) => (
                  <span style="color: red">{error.message}</span>
                )}
              >
                Text
              </Route.Details>
            </div>
          </div>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
