<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPA details demo</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>

    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import {
        registerRoute,
        // eslint-disable-next-line no-unused-vars
        SPADetails,
        // eslint-disable-next-line no-unused-vars
        Route,
      } from "@jsenv/router";

      /**
       * TODO:
       *
       * une route en active avant que le jsx arrive
       * (en gros on a fait currentEntry.updateState({ first_details_open: true }) avant que le jsx arrive)
       *
       * une route en erreur avant que le jsx arrive (le details doit afficher l'erreur)
       *
       *
       */

      const firstDetailsRoute = registerRoute({
        match: (state) => state.first_details_open === true,
        enter: (state) => {
          state.first_details_open = true;
        },
        leave: (state) => {
          state.first_details_open = false;
        },
        canDisplayOldData: true,
        load: async () => {
          await new Promise((resolve) => {
            setTimeout(resolve, 1000);
          });
          return "Hello";
        },
        name: "loadingFor1sRoute",
      });

      const errorAfter500Route = registerRoute({
        match: (state) => state.error_after_500_open === true,
        enter: (state) => {
          state.error_after_500_open = true;
        },
        leave: (state) => {
          state.error_after_500_open = false;
        },
        canDisplayOldData: true,
        load: async () => {
          await new Promise((resolve) => {
            setTimeout(resolve, 500);
          });
          throw new Error("Error after 500ms");
        },
        name: "errorAfter500Route",
      });

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <div style="display: flex; flex-direction: row; gap: 30px">
            <div style="width: 200px;">
              <p>
                <strong>Loading for 1s</strong>
              </p>
              <SPADetails
                route={firstDetailsRoute}
                loaded={({ route }) => <span>{route.data}</span>}
              >
                <SPADetails.Summary>Text</SPADetails.Summary>
              </SPADetails>
            </div>
            <div style="width: 200px;">
              <p>
                <strong>Error after 0.5s</strong>
              </p>
              <SPADetails
                route={errorAfter500Route}
                loaded={({ route }) => <span>{route.data}</span>}
              >
                <SPADetails.Summary>Text</SPADetails.Summary>
              </SPADetails>
            </div>
          </div>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
