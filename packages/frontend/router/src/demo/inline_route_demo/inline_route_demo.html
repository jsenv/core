<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inline route demo</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>
    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import {
        registerRoute,
        registerInlineRoute,
        useRouteUrl,
        // eslint-disable-next-line no-unused-vars
        Route,
        useRouteLoadingState,
        useRouteData,
      } from "@jsenv/router";

      const ROOT_ROUTE = registerRoute("/", () => "root content");
      const A_ROUTE = registerRoute("/a", () => "a content");
      const B_ROUTE = registerRoute("/b", () => "b content");

      const MENU_INLINE_ROUTE = registerInlineRoute(
        { menu_opened: true },
        () => "menu content",
      );

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        const rootUrl = useRouteUrl(ROOT_ROUTE);
        const aUrl = useRouteUrl(A_ROUTE);
        const bUrl = useRouteUrl(B_ROUTE);

        const links = [
          {
            url: rootUrl,
            text: "root",
          },
          {
            url: aUrl,
            text: "a",
          },
          {
            url: bUrl,
            text: "b",
          },
        ];

        const menuIsOpened = useRouteIsActive(MENU_INLINE_ROUTE);

        return (
          <div>
            <h1>Navigation</h1>
            <nav style="display: flex; gap: 0px">
              {links.map((link) => {
                return (
                  <div style="display: flex; flex-direction: column; width: 200px">
                    <a
                      href={link.url}
                      style={{
                        padding: "10px",
                        border: "1px solid black",
                      }}
                    >
                      {link.text}
                    </a>
                  </div>
                );
              })}
            </nav>

            <h1>Content</h1>
            <aside>
              <details
                onToggle={(e) => {
                  if (e.target.open) {
                    // we want to activate the route
                    // how do we do this, in theory I'm supposed to navigate to the route
                  } else {
                  }
                }}
                open={menuIsOpened}
              >
                <summary>Menu</summary>
                <Route
                  route={MENU_INLINE_ROUTE}
                  loading={Loading}
                  loaded={RouteDisplay}
                />
              </details>
            </aside>
            <main style="padding: 10px; border: 1px solid black; margin-top: 10px">
              <Route
                route={ROOT_ROUTE}
                loading={Loading}
                loaded={RouteDisplay}
              />
              <Route route={A_ROUTE} loading={Loading} loaded={RouteDisplay} />
              <Route route={B_ROUTE} loading={Loading} loaded={RouteDisplay} />
            </main>
          </div>
        );
      };

      const Loading = () => {
        return "loading...";
      };
      const RouteDisplay = ({ route }) => {
        const readyState = useRouteLoadingState(route);
        const data = useRouteData(route);
        return (
          <div>
            page state: {readyState}
            <br />
            page data: {data}
          </div>
        );
      };

      render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
