<!doctype html>
<html>
  <head>
    <title>Basic Transform Validation Message Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="icon" href="data:," />
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: linear-gradient(45deg, #e0ffe0, #f0fff0);
        min-height: 300vh; /* Make page scrollable */
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      .section {
        margin: 40px 0;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .target-element {
        display: inline-block;
        padding: 12px 20px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 10px;
        font-size: 16px;
      }

      .target-element:hover {
        background: #45a049;
      }

      .spacer {
        height: 200px;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 20px,
          rgba(0, 255, 0, 0.1) 20px,
          rgba(0, 255, 0, 0.1) 40px
        );
        margin: 40px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        font-weight: bold;
        font-size: 18px;
      }

      .scroll-instruction {
        position: fixed;
        top: 10px;
        right: 10px;
        background: #4caf50;
        color: white;
        padding: 10px;
        border-radius: 4px;
        font-size: 14px;
        z-index: 1000;
      }

      .scrollable-container {
        height: 300px;
        width: 100%;
        overflow: auto;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: #f5fff5;
        padding: 20px;
      }

      .scrollable-content {
        height: 600px;
        width: 800px;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 30px,
          rgba(0, 255, 0, 0.1) 30px,
          rgba(0, 255, 0, 0.1) 60px
        );
      }

      .comparison-note {
        background: #e8f5e8;
        border: 1px solid #4caf50;
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
        color: #2e7d32;
      }

      /* Basic validation message styles */
      .basic-validation-message {
        position: absolute;
        top: 0;
        left: 0;
        background: #fff;
        border: 2px solid #4caf50;
        border-radius: 4px;
        padding: 12px 16px;
        font-size: 14px;
        font-family: Arial, sans-serif;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        max-width: 300px;
        z-index: 1000;
        color: #333;
        pointer-events: none;
        transform-origin: top left;
      }

      .basic-validation-message::before {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 8px solid #4caf50;
      }

      .basic-validation-message::after {
        content: "";
        position: absolute;
        bottom: -6px;
        left: 21px;
        width: 0;
        height: 0;
        border-left: 7px solid transparent;
        border-right: 7px solid transparent;
        border-top: 7px solid #fff;
      }
    </style>
  </head>
  <body>
    <div class="scroll-instruction">
      Scroll to test basic transform positioning
    </div>

    <div class="container">
      <h1>Basic Transform Validation Message Demo</h1>
      <p>
        This demo shows a simple validation message positioned using basic
        JavaScript with transform and absolute positioning.
      </p>

      <div class="comparison-note">
        <strong>Note:</strong> This demo uses a very basic positioning system
        with window event listeners (scroll, resize, touchmove) and transform:
        translate() for positioning. Compare with the jsenv validation message
        system and Tether.js.
      </div>

      <div class="section">
        <h2>Auto-opened Basic Transform Message</h2>
        <p>
          This simple validation message opens automatically and uses basic
          transform positioning:
        </p>
        <p>
          <strong
            >Scroll inside the container below to test basic positioning within
            a scrollable parent:</strong
          >
        </p>
        <div class="scrollable-container">
          <div class="scrollable-content">
            <div>Top of scrollable area</div>
            <button id="auto-target" class="target-element">
              Target Element (Basic transform-positioned message)
            </button>
            <div>Bottom of scrollable area</div>
          </div>
        </div>
      </div>

      <div class="spacer">
        Scroll Area 1 - Keep scrolling to test basic transform positioning
      </div>

      <div class="section">
        <h2>Middle Section</h2>
        <p>
          The basic transform-positioned message should follow the target
          element as you scroll.
        </p>
      </div>

      <div class="spacer">Scroll Area 2 - More scrolling space</div>

      <div class="section">
        <h2>Another Section</h2>
        <p>
          Continue scrolling to test the basic transform message positioning at
          different scroll positions.
        </p>
      </div>

      <div class="spacer">Scroll Area 3 - Bottom section</div>

      <div class="section">
        <h2>Final Section</h2>
        <p>
          Scroll back up to see how the basic transform validation message
          behaves.
        </p>
      </div>

      <div
        style="
          height: 50vh;
          background: #f0f0f0;
          display: flex;
          align-items: center;
          justify-content: center;
          margin-top: 40px;
        "
      >
        <p>Bottom spacer - scroll back up to see basic transform messages</p>
      </div>
    </div>

    <script>
      // Very basic validation message positioning system
      function createBasicValidationMessage(targetElement, message) {
        // Create the validation message element
        const validationMessage = document.createElement("div");
        validationMessage.className = "basic-validation-message";
        validationMessage.innerHTML = message;

        // Add to document body
        document.body.appendChild(validationMessage);

        // Basic positioning function
        function updatePosition() {
          const targetRect = targetElement.getBoundingClientRect();

          // Position below the target element with some offset
          const x = targetRect.left;
          const y = targetRect.bottom + 10;

          // Use transform for positioning
          validationMessage.style.transform = `translateX(${x}px) translateY(${y}px)`;

          console.log(
            `Basic positioning: translateX(${x}px) translateY(${y}px)`,
          );
        }

        // Initial position
        updatePosition();

        // Listen to various events for position updates
        const events = ["scroll", "resize", "touchmove"];

        // Add event listeners to window
        events.forEach((eventType) => {
          window.addEventListener(eventType, updatePosition, { passive: true });
        });

        // Also listen to scroll events on all scrollable parents
        let element = targetElement.parentElement;
        const scrollListeners = [];

        while (element && element !== document.body) {
          const computedStyle = window.getComputedStyle(element);
          if (
            computedStyle.overflow === "auto" ||
            computedStyle.overflow === "scroll" ||
            computedStyle.overflowY === "auto" ||
            computedStyle.overflowY === "scroll" ||
            computedStyle.overflowX === "auto" ||
            computedStyle.overflowX === "scroll"
          ) {
            element.addEventListener("scroll", updatePosition, {
              passive: true,
            });
            scrollListeners.push({ element, listener: updatePosition });
          }
          element = element.parentElement;
        }

        // Return cleanup function
        return () => {
          // Remove window event listeners
          events.forEach((eventType) => {
            window.removeEventListener(eventType, updatePosition, {
              passive: true,
            });
          });

          // Remove scrollable parent listeners
          scrollListeners.forEach(({ element, listener }) => {
            element.removeEventListener("scroll", listener, { passive: true });
          });

          // Remove element from DOM
          if (document.body.contains(validationMessage)) {
            document.body.removeChild(validationMessage);
          }
        };
      }

      // Auto-open validation message on page load
      window.addEventListener("load", () => {
        const autoTarget = document.getElementById("auto-target");
        createBasicValidationMessage(
          autoTarget,
          `This is a very long validation message positioned with <strong>basic JavaScript transforms</strong> that was opened automatically when the page loaded. <strong>Try scrolling both horizontally and vertically</strong> within the container to see how the basic transform-positioned message follows the target element! This message is intentionally made very long to test how basic positioning handles messages that exceed the visible area of their container. The message uses simple transform: translateX() and translateY() for positioning and listens to window scroll, resize, and touchmove events. You can scroll in any direction - up, down, left, right - to test how well this basic positioning system works with scrollable parents. This lengthy content helps verify that basic transform positioning can handle edge cases where the message content is larger than the available viewport space within scrollable containers.`,
        );

        console.log("Basic transform validation message demo loaded.");
      });

      // Log scroll events for debugging
      let scrollTimeout;
      window.addEventListener("scroll", () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          console.log("Window scroll ended at position:", window.scrollY);
        }, 100);
      });
    </script>
  </body>
</html>
