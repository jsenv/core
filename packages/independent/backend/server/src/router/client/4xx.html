<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>405 Method Not Allowed</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }
      .error_container {
        text-align: center;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .error_status {
        font-size: 5rem;
        color: #dc3545;
        margin: 0;
      }
      .error_status_text {
        font-size: 1.5rem;
        margin: 10px 0;
      }
      .error_message {
        font-size: 1rem;
        color: #555;
      }
      .home_link {
        margin-top: 15px;
        display: inline-block;
        padding: 10px 15px;
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
      }
      .home_link:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="error_container">
      <p class="error_status">${status}</p>
      <p class="error_status_text">${statusText}</p>
      <p class="error_message">${message}</p>
      <a href="/" class="home_link">Return to Home</a>
    </div>
    <script>
      const autoreloadOnServerReconnect = async () => {
        const connect = () => {
          const websocket = new WebSocket(websocketUrl, ["jsenv_server"]);
          const connectedPromise = new Promise((resolve) => {
            websocket.onerror = () => {
              resolve(null);
            };
            websocket.onopen = () => {
              resolve(websocket);
            };
          });
          return connectedPromise;
        };

        const websocketScheme =
          self.location.protocol === "https:" ? "wss" : "ws";
        const websocketUrl = `${websocketScheme}://${self.location.host}${self.location.pathname}${self.location.search}`;
        const initialWebSocket = await connect();
        initialWebSocket.onclose = async () => {
          console.info("connection to server lost, trying to reconnect");
          let attemptCount = 0;
          const tryToReconnect = async () => {
            const newWebsocket = await connect();
            if (newWebsocket) {
              console.info("reconnected to server, reloading the page...");
              window.location.reload(true);
              return;
            }
            attemptCount++;
            if (attemptCount === 5) {
              console.info("failed to reconnect to server");
              return;
            }
            // retry after a delay
            await new Promise((resolve) => setTimeout(resolve, 200));
            await tryToReconnect();
          };
          await tryToReconnect();
        };
      };
      autoreloadOnServerReconnect();
    </script>
  </body>
</html>
