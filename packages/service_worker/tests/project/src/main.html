<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <link rel="icon" href="data:," />
  </head>

  <body>
    <div id="ui">
      <div id="animal_ui">
        <fieldset>
          <legend>
            <span>Animal image</span>
          </legend>
          <img style="display: block" height="200" />
        </fieldset>
      </div>
      <div id="service_worker_ui">
        <fieldset name="controller">
          <legend>Navigator controller</legend>

          <span id="controller"></span>
        </fieldset>
        <fieldset name="registration">
          <legend>Service worker script registration</legend>

          <button id="register" disabled>
            <span>register sw.js</span>
          </button>
          <button id="unregister" disabled>
            <span>unregister</span>
          </button>
          <br />
          <br />
          <div id="error" style="display: none">
            <span>error</span>
          </div>
          <div id="installing" style="display: none">
            <span>installing...</span>
            <button id="resolve_install" disabled>
              <span>Resolve install promise</span>
            </button>
            <button id="reject_install" disabled>
              <span>Reject install promise</span>
            </button>
          </div>
          <div id="installed" style="display: none">
            <span>installed</span>
          </div>
          <div id="activating" style="display: none">
            <span>activating....</span>
            <button id="resolve_activate" disabled>
              <span>Resolve activate promise</span>
            </button>
            <button id="reject_activate" disabled>
              <span>Reject activate promise</span>
            </button>
          </div>
          <div id="activated" style="display: none">
            <span>activated</span>
          </div>
          <div id="redundant" style="display: none">
            <span>redundant</span>
          </div>
        </fieldset>
        <fieldset name="update">
          <legend>Service worker script update</legend>

          <button id="update_check_button" disabled>Check for updates</button>
          <br />
          <label>
            Allow image hot update
            <input type="checkbox" id="image_hot_update" />
          </label>
          <br />
          <br />

          <div id="update_installing" style="display: none">
            <span>update installing...</span>
            <button id="update_resolve_install" disabled>
              <span>Resolve install promise</span>
            </button>
            <button id="update_reject_install" disabled>
              <span>Reject install promise</span>
            </button>
          </div>
          <div id="update_installed" style="display: none">
            <span>update installed</span>
            <button id="update_by_restart_button" disabled>
              <span>Restart to update</span>
            </button>
            <button id="update_now_button" disabled>
              <span>Apply update</span>
            </button>
          </div>
          <div id="update_activating" style="display: none">
            <span>update activating....</span>
            <button id="update_resolve_activate" disabled>
              <span>Resolve activate promise</span>
            </button>
            <button id="update_reject_activate" disabled>
              <span>Reject activate promise</span>
            </button>
          </div>
          <div id="update_activated" style="display: none">
            <span>activated</span>
          </div>
          <div id="update_redundant" style="display: none">
            <span>redundant</span>
          </div>
        </fieldset>
      </div>
    </div>
    <div id="trigger_file_changes">
      <fieldset>
        <legend>Update files</legend>
        <button id="build_dog">Build dog</button>
        <button id="build_horse">Build horse</button>
        <button id="build_cat">Build cat</button>
        <button id="build_sw_script">Build sw script</button>
      </fieldset>
    </div>

    <script type="module">
      import { pwaLogger, navigatorControllerRef } from "@jsenv/pwa"

      pwaLogger.setOptions({
        logLevel: "debug",
      })

      const controllerSpan = document.querySelector("#controller")
      navigatorControllerRef.subscribe((controller) => {
        if (controller) {
          controllerSpan.innerHTML = `${controller.meta.name}`
        } else {
          controllerSpan.innerHTML = "no"
        }
      })

      build: {
        const buildDogButton = document.querySelector("#build_dog")
        buildDogButton.onclick = async () => {
          buildDogButton.disabled = true
          await fetch("/update_animal_to_dog")
          buildDogButton.disabled = false
        }
        const buildHorseButton = document.querySelector("#build_horse")
        buildHorseButton.onclick = async () => {
          buildHorseButton.disabled = true
          await fetch("/update_animal_to_horse")
          buildHorseButton.disabled = false
        }
        const buildCatButton = document.querySelector("#build_cat")
        buildCatButton.onclick = async () => {
          buildCatButton.disabled = true
          await fetch("/update_animal_to_cat")
          buildCatButton.disabled = false
        }
      }
    </script>
    <script type="module" src="main.js"></script>
  </body>
</html>
