<!doctype html>
<html>
  <head>
    <title>Validity demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="icon" href="data:," />
  </head>
  <body>
    <div id="app">
      <h1>Validity demo</h1>

      <label>
        <input id="enable" checked type="checkbox" />
        Enable error when contains letter "c"
      </label>

      <h2>Input with form</h2>
      <form action="javascript:void(0)">
        <input
          id="with_form"
          type="text"
          required
          pattern="[a-z]{4,8}"
          title="4 to 8 lowercase letters"
          autocomplete="off"
          value="b"
        />
        <button id="with_form_add">Add custom error</button>
        <button id="with_form_remove">Remove custom error</button>
      </form>

      <h2>Input without form</h2>
      <input
        id="without_form"
        type="text"
        required
        pattern="[a-z]{4,8}"
        title="4 to 8 lowercase letters"
        autocomplete="off"
        value="a"
      />
      <button id="without_form_add">Add custom error</button>
      <button id="without_form_remove">Remove custom error</button>
    </div>
    <script type="module">
      // TODO: we need an input where we set a custom validity message during "input"
      // and see how everything interacts, note that
      // something like "The letter "a" is not allowed" if input contains an "a"

      import { createInputValidity } from "./input_validity.js";

      const withForm = document.querySelector("#with_form");
      withForm.onkeydown = (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          withForm.form.requestSubmit();
        }
      };
      const withFormInputValidity = createInputValidity(withForm, {
        onCancel: () => {
          withForm.value = "b";
        },
      });
      const withFormAddButton = document.querySelector("#with_form_add");
      const withFormRemoveButton = document.querySelector("#with_form_remove");
      withFormAddButton.onclick = () => {
        withFormInputValidity.addCustomValidity(
          "custom_error",
          "Custom error message",
        );
      };
      withFormRemoveButton.onclick = () => {
        withFormInputValidity.removeCustomValidity("custom_error");
      };

      const withoutForm = document.querySelector("#without_form");
      const withoutFormInputValidity = createInputValidity(withoutForm, {
        onCancel: () => {
          withoutForm.value = "a";
        },
      });
      const withoutFormAddButton = document.querySelector("#without_form_add");
      const withoutFormRemoveButton = document.querySelector(
        "#without_form_remove",
      );
      withoutFormAddButton.onclick = () => {
        withoutFormInputValidity.addCustomValidity(
          "custom_error",
          "Custom error message",
        );
      };
      withoutFormRemoveButton.onclick = () => {
        withoutFormInputValidity.removeCustomValidity("custom_error");
      };

      const enable = document.querySelector("#enable");
      withoutForm.addEventListener("input", () => {
        if (enable.checked && withoutForm.value.includes("c")) {
          withoutFormInputValidity.addCustomValidity(
            "contains_c",
            "The letter 'c' is not allowed",
          );
        } else {
          withoutFormInputValidity.removeCustomValidity("contains_c");
        }
      });
      withForm.addEventListener("input", () => {
        if (enable.checked && withForm.value.includes("c")) {
          withFormInputValidity.addCustomValidity(
            "contains_c",
            "The letter 'c' is not allowed",
          );
        } else {
          withFormInputValidity.removeCustomValidity("contains_c");
        }
      });
    </script>
  </body>
</html>
